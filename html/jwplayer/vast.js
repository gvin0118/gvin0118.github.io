!function(){var e,u="vast",G="-1",Y="time",d="[ERRORCODE]",Z="beforeComplete",C="vmap",ee=5e3,te=15e3,ie="jwp",re="jwpspotx",ne="autostartNotAllowed",ae="viewable",se=5,c="paused",oe="playing",r="viewable",de="adBidRequest",le="adBidResponse",ue="adBreakEnd",n="adBreakIgnored",ce="adBreakStart",a="adClick",i="adComplete",pe="adError",he="adImpression",me="adItem",fe="adLoaded",p="adMeta",s="adPause",l="adPlay",ve="adPlayComplete",ge="adPodError",ye="adRequest",Ae="adSchedule",h="adSkipped",t="adStarted",m="clickthrough",we="external",f=we,o="click",v="play",g="error",y="complete",A=[he,pe,ge],w=[t,i,he,a,h,pe,l,s,p],k="instream",P="article",_=((e={})[[k]]=1,e[["banner"]]=2,e[[P]]=3,e[["feed"]]=4,e[["floating"]]=5,e[["interstitial"]]=5,e[["slider"]]=5,e),b=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},T=function(){function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,i){return t&&r(e.prototype,t),i&&r(e,i),e}}(),ke=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e},I=function(){function s(e,t,i,r,n){var a=this;b(this,s),this.player=e,this.state=e.state,this.vpaidURL=i,this.adTag=r,this.adParams=n.adParams,this.vpaidControls=n.vpaidControls,this.remainingTimeInterval=null,this.type="vpaid",this.instream=t||e.createInstream(),this.vpaidState={linear:!1,expanded:!1,remainingTime:-1},this.paused=!1,ke(this,e.Events),this.setMuteCallback=function(){a.handleMute?a.setMute():a.handleMute=!0},this.playerContainer=this.player.getContainer(),n.adOptOut?setTimeout(function(){a.sendEvent("error",{message:"Conditional ad rejected",code:408})},0):this.iframe=function(e,t,i,r){var n=document.createElement("iframe");n.setAttribute("allow","autoplay"),n.src="javascript:false",n.classList.add("jw-vpaid-iframe"),n.scrolling="no",i.querySelector(".jw-media").appendChild(n);var a=n.contentWindow.document;return a.open().write("\n    <body onload=\"\n        var js = document.createElement('script');\n        js.src = '"+t+"';\n        js.addEventListener('load', function() { window.myCallback(); });\n        document.body.appendChild(js);\"\n    style=\"margin: 0\">"),n.contentWindow.myCallback=r,a.close(),n}(e.utils,this.vpaidURL,this.playerContainer,this.callback.bind(this))}return s.prototype.sendEvent=function(e,t){(t=t||{}).tag||(t.tag=this.adTag),this.trigger(e,t)},s.prototype.sendTimeEvent=function(e,t,i){var r=t.getAdDuration(),n=t.getAdRemainingTime(),a=ke({duration:r},i);this.sendEvent(e,a),0<n&&(a.position=r-n,this.trigger("time",a))},s.prototype.handleQuartile=function(e,t){this.sendTimeEvent("quartile",e,{quartile:t})},s.prototype.genEvent=function(t){var i=this;return function(e){i.on(t,e)}},s.prototype.setMute=function(){var e=0===this.vpaidAd.getAdVolume();this.player.getMute()!==e&&this.player.setMute(e)},s.prototype.prepareNonlinearAd=function(){if(this.player.utils.style(this.iframe,{height:150}),this.iframe.classList.add("jw-vpaid-non-linear"),this.resize(null,150),this.instream){this.instream.noResume=!0,this.instream.applyProviderListeners(null),this.instream.destroy(),this.instream=null;var e=this.playerContainer.querySelector(".jw-media"),t=e.querySelector("video,audio");e.insertBefore(t,this.iframe),t.play()}},s.prototype.progressInterval=function(t){var i=this;if(clearInterval(this.remainingTimeInterval),t&&t.getAdRemainingTime){var r=-1;this.remainingTimeInterval=setInterval(function(){if(!i.paused){var e=t.getAdRemainingTime();isNaN(e)||e<=0||r===e||(r=e,i.sendTimeEvent("remainingTimeChange",t,{remainingTime:e}))}},250)}},s.prototype.genListeners=function(r){var n=this;return{AdLoaded:function(){r.setAdVolume(n.getPlayerVolume()),r.startAd()},AdStarted:function(){var e=r.getAdDuration?r.getAdDuration():0,t=!r.getAdLinear||r.getAdLinear(),i=t?"linear":"nonlinear";t?n.vpaidControls?n.progressInterval(r):(n.instream=n.instream||n.player.createInstream(),n.instream.hide()):n.prepareNonlinearAd(),n.sendEvent("impression",{linear:i,duration:e}),n.sendEvent("play",{oldstate:"buffering",newstate:oe,linear:i}),n.handleMute=!0,r.subscribe(n.setMuteCallback,"AdVolumeChange",r)},AdVideoStart:function(){n.sendEvent("started")},AdStopped:function(){n.sendEvent("stopped")},AdPaused:function(){n.paused||(n.paused=!0,n.sendEvent("pause",{newstate:c,oldstate:oe}))},AdPlaying:function(){if(n.paused){var e=!r.getAdLinear||r.getAdLinear()?"linear":"nonlinear";n.paused=!1,n.sendEvent("play",{newstate:oe,oldstate:c,linear:e})}},AdLinearChange:function(){!r.getAdLinear||r.getAdLinear()?(n.player.utils.style(n.iframe,{height:"100%"}),n.player.off(null,null,n),n.instream=n.instream||n.player.createInstream(),n.instream.init(),n.vpaidControls||n.instream.hide()):n.prepareNonlinearAd()},AdDurationChange:function(){n.sendTimeEvent("remainingTimeChange",r,{isDurationChange:!0,remainingTime:r.getAdRemainingTime()})},AdRemainingTimeChange:function(){n.paused||n.sendTimeEvent("remainingTimeChange",r,{remainingTime:r.getAdRemainingTime()})},AdExpandedChange:function(){n.sendEvent("expandedChange",{expanded:r.getAdExpanded()})},AdSkipped:function(){n.sendEvent("skipped")},AdVideoFirstQuartile:function(){n.handleQuartile(r,1)},AdVideoMidpoint:function(){n.handleQuartile(r,2)},AdVideoThirdQuartile:function(){n.handleQuartile(r,3)},AdVideoComplete:function(){n.sendEvent("complete")},AdUserClose:function(){n.sendEvent("close")},AdClickThru:function(e,t,i){n.sendEvent("click",{id:t,url:e,playerHandles:i})},AdError:function(e){var t=function(e){if(e){var t=e.match(/\b(?:[34])[0-9]{2}\b/);if(t)return parseInt(t[0],10);if(e.match(/timeout/i))return e.match(/vpaid|vast/i)?301:402;if(e.match(/found/i))return 401;if(e.match(/supported/i))return 403;if(e.match(/(?:displaying|media file)/i))return 405}return 901}(e);n.sendEvent("error",{message:e,code:t,adErrorCode:5e4+t})}}},s.prototype.callback=function(){try{this.vpaidAd=this.iframe.contentWindow.getVPAIDAd();var e=this.vpaidAd.handshakeVersion("2.0");if(parseFloat(e)<1)throw new Error("Invalid vpaid version in handshake")}catch(e){return void this.sendEvent("error",{message:"VPAID general error",code:901,adErrorCode:51901})}var t=this.vpaidAd,i=this.genListeners(t);Object.keys(i).forEach(function(e){t.subscribe(i[e],e,t)}),this.listeners=i;var r={AdParameters:this.adParams},n=this.playerContainer.querySelector(".jw-media"),a=this.instream.getMediaElement(),s=this.iframe.contentWindow.document.createElement("div");s.className="jw-vpaid-wrapper",s.style.height="100%",this.iframe.contentWindow.document.body.appendChild(s),0<=this.vpaidURL.indexOf("//imasdk.googleapis.com/js/sdkloader/vpaid_adapter.js")&&(this.iframe.contentWindow.HTMLVideoElement=HTMLVideoElement);var o={videoSlot:a,slot:s};t.initAd(n.clientWidth,n.clientHeight,"normal",1e3,r,o),t.setAdVolume(this.getPlayerVolume())},s.prototype.play=function(){this.vpaidAd.resumeAd()},s.prototype.pause=function(){this.vpaidAd.pauseAd()},s.prototype.skip=function(){return!(!this.vpaidAd.skipAd||!this.vpaidAd.getAdSkippableState())&&(this.vpaidAd.skipAd(),!0)},s.prototype.stop=function(){if(this.vpaidAd)try{this.vpaidAd.stopAd()}catch(e){}},s.prototype.getPlayerVolume=function(){return this.player.getMute()?0:this.player.getVolume()/100},s.prototype.setVolume=function(e){this.handleMute=!1,this.vpaidAd.setAdVolume(e/100)},s.prototype.resize=function(e,t){if(this.vpaidAd&&this.vpaidAd.resizeAd){var i=this.player.getFullscreen()||document.fullScreen||document.mozFullScreen||document.webkitIsFullScreen?"fullscreen":"normal";this.vpaidAd.resizeAd(e||this.player.getWidth(),t||this.player.getHeight(),i)}},s.prototype.destroy=function(){if(this.removeEvents(),clearInterval(this.remainingTimeInterval),this.vpaidAd)try{var t=this.listeners,i=this.vpaidAd;Object.keys(t).forEach(function(e){i.unsubscribe(t[e],e,i)}),i.unsubscribe(this.setMuteCallback,"AdVolumeChange",i)}catch(e){}this.iframe&&this.iframe.parentNode&&this.iframe.parentNode.removeChild(this.iframe),this.vpaidAd=null,this.player=null,this.instream=null},s.prototype.removeEvents=function(){this.player&&this.player.off(null,null,this),this.off()},s.prototype.attachMedia=function(){},s.prototype.detachMedia=function(){},s.prototype.volume=function(){},s.prototype.mute=function(){},s.prototype.getState=function(){return this.vpaidState.linear?this.paused?c:oe:"idle"},s}();var E=window.__cmp||function(e,t,i){for(var r=window;r;){try{if(r.frames.__cmpLocator)break}catch(e){}r=r===window.top?null:r.parent}if(r){var n=Pe(),a=function(e){var t=e?e.data:{};if("string"==typeof t)try{t=JSON.parse(t)}catch(e){t={}}t.__cmpReturn&&t.__cmpReturn.callId===n&&(removeEventListener("message",a),i(t.__cmpReturn.returnValue))};window.addEventListener("message",a,!1);var s={__cmpCall:{command:e,parameter:t,callId:n}};r.postMessage(JSON.stringify(s),"*")}else i({gdprApplies:!1,consentData:""})},R=new RegExp(/^[^/]*:\/\/\/?([^\/]*)/);var S=new RegExp(/^[^:\/?#]+:?\/\/[^\/?#]+/);var x=null,M=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1e3;return null===x&&(x=new Promise(function(e){E("getConsentData",null,e)})),Promise.race([x,new Promise(function(e){setTimeout(e,t,{gdprApplies:!0,consentData:""})})])},Pe=Date.now||function(){return(new Date).getTime()};function j(){var e,t,i=null!==document.referrer.match(S)?document.referrer:"";if(window.top!==window.self){try{return{url:window.top.location.href,domain:window.top.document.domain,referrer:i}}catch(e){}return{url:i,domain:(e=i,t=e.match(R),t&&1<t.length?t[1]:""),referrer:""}}return{url:document.location.href,domain:document.domain,referrer:i}}function L(e){var t=e.advertising;if(t&&t.placement){var i=t.placement.toLowerCase();if(_[i])return _[i]}return _[t&&t.outstream?P:k]}var O=function(e){return e.replace(/^\s+|\s+$/g,"")},V=[];var B=function(){function o(e,t,r,i){var n=this;b(this,o);var a,s=e||{};this.map=s,this.debugTrackFn=t,this.trackerPlayerUtils=(a=r,{getPosition:function(){return a.getPosition()},getFile:function(){return a.getPlaylistItem().file},getPlacement:function(){return L(a.getConfig())}}),this.trackingFilter=i,this.lastQuartile=0,this.progressEvents=[],this.breakStarted=!1,this.started=!1,this.firedError=!1,this.hasComp=!1,Object.keys(s).forEach(function(e){if(s.hasOwnProperty(e)&&0===e.indexOf("progress")){var t=""+e.split("_")[1],i={key:e,offset:t,tracked:!1,percentage:!1};/^\d+%$/.test(t)?(i.percentage=!0,i.offset=parseFloat(t)):i.offset=r.utils.seconds(t),n.progressEvents.push(i)}}),this.setFactories()}return o.prototype.getUrls=function(e){return this.map.hasOwnProperty(e)?this.map[e]:[]},o.prototype.addUrl=function(e,t){this.map.hasOwnProperty(e)||(this.map[e]=[]),this.map[e].push(t)},o.prototype.trackPings=function(e){var i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},t=this.getUrls(e),r=this.trackingFilter,n=[],a=[],s=[];if(t.length){i=this.replaceMacros(i),t.forEach(function(t){if(t){if(Object.keys(i).forEach(function(e){t=t.replace(e,i[e])}),r&&!1===r(t))return void a.push(t);var e=new Image;e.src=t,n.push(t),s.push(e)}}),Array.prototype.push.apply(V,s);for(var o=V.length;o--&&(V[o].width||V[o].complete);)V.length=o}"function"==typeof this.debugTrackFn&&this.debugTrackFn({type:"ping",data:{pingType:e,urls:n,filteredUrls:a,images:s}})},o.prototype.replaceMacros=function(e){var t,i,r,n,a,s,o;return e["[TIMESTAMP]"]=encodeURIComponent((t=new Date,i=t.getTime(),r=t.getTimezoneOffset()/60,n=6e4*t.getTimezoneOffset(),new Date(i-n).toISOString().slice(0,-1)+(0<r?"-":"+")+("0"+r).slice(-2))),e["[CACHEBUSTING]"]=Math.random().toString().slice(2,10),e["[ASSETURI]"]=encodeURIComponent(this.trackerPlayerUtils.getFile()),e["[CONTENTPLAYHEAD]"]=encodeURIComponent((a=this.trackerPlayerUtils.getPosition(),s=("0"+Math.floor(a/3600)).slice(-2),o=("0"+Math.floor((a-3600*s)/60)).slice(-2),s+":"+o+":"+("0"+Math.floor(a-3600*s-60*o)).slice(-2)+"."+(a%1).toFixed(3).toString().slice(2,5))),e["[PLACEMENTTYPE]"]=this.trackerPlayerUtils.getPlacement(),e},o.prototype.start=function(){this.started=!0,this.trackPings("start")},o.prototype.breakStart=function(){this.breakStarted=!0,this.trackPings("breakStart")},o.prototype.time=function(e,t){if(!(t<=1)){for(var i=(4*e+.05)/t|0;i>this.lastQuartile&&this.lastQuartile<3;)this.lastQuartile++,1===this.lastQuartile?this.trackPings("firstQuartile"):2===this.lastQuartile?this.trackPings("midpoint"):3===this.lastQuartile&&this.trackPings("thirdQuartile");this.trackProgress(e,t)}},o.prototype.trackProgress=function(e,t){for(var i=this.progressEvents.length;i--;){var r=this.progressEvents[i];if(!r.tracked){var n=r.offset;r.percentage&&(n=t*n/100),n<=e&&(r.tracked=!0,this.trackPings(r.key))}}},o.prototype.error=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:900;this.firedError=!0;var t={};t[d]=e,this.trackPings("error",t)},o.prototype.factory=function(e){var t=this;return function(){t.trackPings(e)}},o.prototype.setFactories=function(){this.creativeView=this.factory("creativeView"),this.click=this.factory("click"),this.skip=this.factory("skip"),this.complete=this.factory("complete"),this.pause=this.factory("pause"),this.resume=this.factory("resume"),this.mute=this.factory("mute"),this.unmute=this.factory("unmute"),this.fullscreen=this.factory("fullscreen"),this.expand=this.factory("expand"),this.collapse=this.factory("collapse"),this.acceptInvitation=this.factory("acceptInvitation"),this.close=this.factory("close"),this.rewind=this.factory("rewind"),this.impression=this.factory("impression"),this.breakEnd=this.factory("breakEnd")},o}();function _e(e,t,i,r){var n=be(e,i,r);return ke(n,{message:t.message,code:100<=t.code&&t.code<=1008?t.code:900,adErrorCode:t.adErrorCode||60900}),void 0!==t.id&&(n.id=t.id),void 0!==t.sourceError&&(n.sourceError=t.sourceError),void 0!==t.tag&&(n.tag=t.tag),void 0!==t.vmap&&(n.vmap=t.vmap),n}function be(r){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,t=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},i={client:u};if(null===r)return i;var n=t.schedule;if(n)return ke(i,{item:r.item,tag:n.getVMAP(),adbreaks:n.getAllAds().map(function(e){var t={type:e._type,offset:e._offSet};e._vmap?t.vmap=e._vmap:t.adbreak=ke({},e._adbreak);var i=r.bidsResult[e.adBreakId];return i&&ke(t,i.getEventObject()),t})});if(r.config.preloadAds&&(i.preloadAds=t.preload||e&&e._preload||!1),e){var a=r.getAdIds(e,t),s=a.adBreakId,o=a.adPlayId;ke(i,{adBreakId:s,adPlayId:o,offset:e._offSet});var d=r.bidsResult[s];d&&ke(i,d.getEventObject())}var l=e&&(t.tag||e._currentTag);return l&&(ke(i,{id:e._id,tag:l,adposition:e._position,sequence:e._adPodIndex+1,witem:e._waterfallIndex+1,wcount:e._adQueue?e._adQueue.length:1,adsystem:e.adsystem||""}),void 0!==e.skipoffset&&(i.skipoffset=e.skipoffset),e.wrappedTags&&ke(i,{wrapperAdSystem:e.wrapper||"",wrappedTags:e.wrappedTags.slice(1)}),e._adbreak&&(i.adschedule=e._adbreak,i.adschedule.offset=e._offSet)),e&&e.companions&&t.companions?i.companions=t.companions:e&&e.response?(ke(i,{adtitle:e.adTitle||"",description:e.description||"",adId:e.adId||"",creativeId:e.creativeId||"",creativeAdId:e.creativeAdId||"",request:e.request,response:e.response,conditionalAd:e.conditionalAd,conditionalAdOptOut:r.params.conditionaladoptout,vastversion:e.vastversion,clickThroughUrl:e.clickthrough,duration:t.duration,linear:t.linear}),"boolean"==typeof e.mediaFileCompliance&&(i.mediaFileCompliance=e.mediaFileCompliance,e.nonComplianceReasons&&(i.nonComplianceReasons=e.nonComplianceReasons)),e.selectedMedia&&(i.mediafile={file:e.selectedMedia.file}),t.metadata&&(i.adMessage=r.params.dynamicMessage||"",e.companions&&(i.companions=e.companions),e.sequence&&(i.podMessage=r.params.podMessage||""),void 0!==e.skipoffset&&ke(i,{skipMessage:r.params.skipMessage,skipText:r.params.skipText}))):i.item=r.item,i}var H=function(){function l(e,t,i){b(this,l),this.player=e,this.icon=t,this.div=i;var r,n,a,s=this.utils=e.utils;this.images=[],this.iconContainer=(r=t.style,n=s,(a=document.createElement("div")).className="jw-ad-icon-container",n.style(a,r),a);var o=function(e,t){var i=e.resourceSource,r=e.resourceType,n=void 0;switch(r){case"iframe":(n=document.createElement("iframe")).src=i,n.scrolling="no";break;case"html":n=document.createElement("div"),t.replaceInnerHtml(n,i);break;default:(n=document.createElement("img")).src=i,n.setAttribute("type",r)}return t.addClass(n,"jw-ad-icon"),n}(t.resource,s);this.iconContainer.appendChild(o),i.appendChild(this.iconContainer);var d=1e3*s.seconds(t.offset);0<d?this.showTimeout=setTimeout(this.show.bind(this),d):this.show(),this.ui=new s.UI(this.iconContainer).on("click tap",this.clickHandler,this)}return l.prototype.clickHandler=function(){this.player.pause({reason:m}),this.sendPing(this.icon.trackers.iconClick),this.utils.openLink(this.icon.clickThrough,"_blank",{rel:"noreferrer"})},l.prototype.show=function(){clearTimeout(this.showTimeout),this.utils.addClass(this.iconContainer,"jw-ad-icon-active"),this.sendPing(this.icon.trackers.iconView),this.icon.duration&&(this.duration=this.utils.seconds(this.icon.duration),this.beginningPosition=this.utils.seconds(this.icon.offset))},l.prototype.updateTime=function(e){e-this.beginningPosition>=this.duration&&this.remove()},l.prototype.sendPing=function(e){if(e){var t=this.images,i=new Image;i.src=e;for(var r=t.length;r--&&(t[r].width||t[r].complete);)t.length=r;t.push(i)}},l.prototype.remove=function(){clearTimeout(this.showTimeout),this.div.contains(this.iconContainer)&&this.div.removeChild(this.iconContainer),this.ui&&(this.ui.destroy(),this.ui=null)},l}();var Te=function(){function o(e,t,i,r,n,a,s){b(this,o),this.player=t,this.staticPlayer=i,this.companion=r,this.playlistItemManager=n,this.div=a,this.optionalParams=s,this.debugTrackFn=s.debugTrackFn,this.scheduledAd=e.scheduledAd(),this.vastBuffet=e.adBuffet(),this.vastAdPod=e.adPod(),this.vastAd=this.vastBuffet.length?this.vastBuffet[0]:null,this.adType=null,this.vpaidPlayer=null,this.instreamPlayer=null,this.blockingInstreamPlayer=null,this.mediaType=null,this.adPodItems=null,this.creativeTimeout=null,this.vastOptions=null,this.duration=0,this.position=0,this.initialIndex=0,this.viewablePlayedTime=0,this.adViewableImpressionHandler=t.utils.noop,this.lastPosition=null,this.reason=null,ke(this,t.Events)}return o.prototype.init=function(e,t){return this.init=function(){throw new Error("Adplayer can only be initialized once")},this.blockingInstreamPlayer=e,this.reason=t,this.prepareAdPod()?(this.player.on("fullscreen",this.playerFullscreenHandler,this),this.player.on("volume",this.playerVolumeHandler,this),this.player.on("mute",this.muteHandler,this),this.player.on("resize",this.playerResizeHandler,this),this.playAd()):Promise.reject()},o.prototype.prepareAdPod=function(){var t=this,e=null,i=0,r=[];if(this.vastAd&&(F(this.vastAd,this.debugTrackFn,this.player,this.optionalParams.trackingFilter),(e=this.prepareAdPodItem(this.vastAd))&&"vpaid"===e.adType&&!D(this.vastAd)&&(e=null)),this.vastAdPod)for(var n=null,a=0;a<this.vastAdPod.length;a++){var s=this.vastAdPod[a];F(s,this.debugTrackFn,this.player,this.optionalParams.trackingFilter);var o=this.prepareAdPodItem(s);if(o){if(n!==o.adType&&"instream"===n)break;if(n=o.adType,"vpaid"!==o.adType||D(s)){var d=r.length+i===a;o&&d&&r.push(o)}else i++}else i++}if(!r.length&&!e)return this.scheduledAd._pod&&this.scheduledAd._pod.length||this.adError("No Compatible Creatives",403),!1;var l=void 0;return r.length?(l=r,this.vastOptions=[],l.forEach(function(e){t.vastOptions.push(t.getInstreamOptions(e.vastAd))})):(l=e,this.vastOptions=this.getInstreamOptions(this.vastAd)),this.adPodItems=l,!0},o.prototype.prepareAdPodItem=function(e){e.tracker.linear="linear";var t=(""+e.media[0].adType).toLowerCase()||"instream";"vpaid"!==t||D(e)||(t="instream");var i={vastAd:e,sources:[],adType:t};this.scheduledAd.skipoffset&&(i.skipoffset=this.scheduledAd.skipoffset);var r=e.media,n={};if(r.forEach(function(e){i.sources.push({file:e.file,mimeType:e.type,type:(""+e.type).replace(/^(?:video|audio)\/(?:x-)?/,"")}),n[e.file]={width:e.width||0,height:e.height||0}}),"instream"===t&&(i.sources=function(e){var i=void 0;i=jwplayer.api.availableProviders.filter(function(e){return"flash"!==e.name});var t=e.filter(function(t){return i.some(function(e){return e.supports(t)})}),r=t.filter(function(e){return"3gpp"!==e.type});return r.length?r:t}(i.sources)),0===i.sources.length)return null;i.vastAd.selectedMedia=i.sources[0];var a=this.player.getSafeRegion(!0),s=null,o=null;return i.sources.forEach(function(e){var t=n[e.file];t.width<=a.width&&(!s||t.width>n[s.file].width)&&(s=e),t.width>=a.width&&(!o||t.width<n[o.file].width)&&(o=e)}),s?(i.vastAd.selectedMedia=s).default=!0:o&&((i.vastAd.selectedMedia=o).default=!0),this.mediaType=i.vastAd.selectedMedia.mimeType.toLowerCase(),i.sources=[i.vastAd.selectedMedia],i},o.prototype.getInstreamOptions=function(e){return{skipoffset:this.getSkipOffset(e),skipMessage:this.optionalParams.skipMessage,skipText:this.optionalParams.skipText}},o.prototype.getSkipOffset=function(e){var t=0<=this.optionalParams.skipoffset?this.optionalParams.skipoffset:null;return this.scheduledAd.skipoffset||t||this.player.utils.seconds(e.skipoffset)},o.prototype.getVastAd=function(){var e=this.scheduledAd._adPodIndex;if(this.adPodItems){var t=void 0;if((t=this.adPodItems.length?this.adPodItems[e]:this.adPodItems).vastAd)return t.vastAd}else if(this.vastAdPod&&this.vastAdPod.length)return this.vastAdPod[e];return this.vastAd},o.prototype.adError=function(e,t,i){clearTimeout(this.creativeTimeout),this.creativeTimeout=null;var r=this.getVastAd();N(r),t=t||900;var n="vpaid"===this.adType?5e4:1e4;i=i||n+t;var a=ke({},this.scheduledAd,r),s=_e(this.playlistItemManager,{message:e,code:t,adErrorCode:i},a);this.vastAdPod&&this.scheduledAd._adPodIndex<this.vastAdPod.length-1?this.triggerEvent(ge,s):(r.tracker.error(s.code),this.triggerEvent(pe,s),this.removePlayerListeners())},o.prototype.playAd=function(){var e=this.scheduledAd._adPodIndex,t=this.adPodItems[e]||this.adPodItems;if(this.adType=t.adType,this.blockingInstreamPlayer){var i=this.optionalParams.loadingAd;this.blockingInstreamPlayer.setText(i)}if("vpaid"===this.adType)return this.playVpaid(t.vastAd);if("static"===this.adType)return this.playStatic(),Promise.resolve();var r=Array.isArray(this.adPodItems)?this.adPodItems.slice(e):this.adPodItems,n=Array.isArray(this.vastOptions)?this.vastOptions.slice(e):this.vastOptions;return this.initialIndex=e,this.playInstream(r,n)},o.prototype.clearVpaidBlocking=function(){var e=this.vpaidPlayer.instream;e&&e!==this.blockingInstreamPlayer&&(this.vpaidPlayer.instream=null,this.clearBlocking(e))},o.prototype.clearBlocking=function(e){(e=e||this.blockingInstreamPlayer)&&e!==this.instreamPlayer&&e.destroy()},o.prototype.getState=function(){return this.instreamPlayer?this.instreamPlayer.getState():this.vpaidPlayer?this.vpaidPlayer.getState():""},o.prototype.clearNonlinear=function(){this.staticPlayer.stop(),this.vpaidPlayer&&(this.clearVpaidBlocking(),this.vpaidPlayer&&(this.vpaidPlayer.stop(),this.vpaidPlayer.destroy(),this.vpaidPlayer=null))},o.prototype.destroy=function(){if(this.off(),this.removePlayerListeners(),clearTimeout(this.creativeTimeout),this.creativeTimeout=null,this.instreamPlayer){var e=this.instreamPlayer;this.instreamPlayer=null,this.clearBlocking(e)}this.vpaidPlayer&&(this.clearVpaidBlocking(),this.vpaidPlayer&&(this.vpaidPlayer.destroy(),this.vpaidPlayer=null)),this.clearNonlinear(),N(this.vastAd),this.player=null,this.instreamPlayer=null,this.scheduledAd=null,this.vastBuffet=null,this.vastAd=null,this.vastAdPod=null},o.prototype.pause=function(e){var t=e.reason;this.reason=t||we,this.instreamPlayer?this.instreamPlayer.pause():this.vpaidPlayer&&this.vpaidPlayer.pause()},o.prototype.play=function(e){var t=e.reason;this.reason=t||we,this.instreamPlayer?this.instreamPlayer.play():this.vpaidPlayer&&this.vpaidPlayer.play()},o.prototype.skip=function(){if(this.instreamPlayer){var e=this.getSkipOffset(this.getVastAd());if(0<e&&this.position<e)return;this.instreamPlayer.skipAd()}else this.vpaidPlayer&&this.vpaidPlayer.skip()},o.prototype.removePlayerListeners=function(){this.player&&(this.player.off("fullscreen",this.playerFullscreenHandler,this),this.player.off("volume",this.playerVolumeHandler,this),this.player.off("mute",this.muteHandler,this),this.player.off(r,this.viewableHandler,this)),this.instreamPlayer&&this.instreamPlayer.off(null,null,this),this.vpaidPlayer&&(this.vpaidPlayer.removeEvents(),this.clearVpaidBlocking(),this.vpaidPlayer&&(this.vpaidPlayer.destroy(),this.vpaidPlayer=null)),this.staticPlayer.stop(),this.staticPlayer.removeEvents()},o.prototype.adEventObject=function(e){var t=this.getVastAd(),i=ke({},this.scheduledAd,t),r=be(this.playlistItemManager,i);return r.viewable=this.player.getViewable(),this.adPodItems&&this.adPodItems.length&&(r.sequence=this.scheduledAd._adPodIndex+1,r.podcount=this.adPodItems.length),this.mediaType&&(r.creativetype=this.mediaType),this.scheduledAd._vmap&&(r.vmap=this.scheduledAd._vmap),-1!==w.indexOf(e)&&(r.universalAdId=t.universalAdId,r.categories=t.categories),r},o.prototype.playStatic=function(){this.vastAd.tracker.linear="nonlinear";var e=this.vastAd.media[0];this.vastAd.selectedMedia=e;var t=this.vastAd.clickthrough||"",i=this.staticPlayer;i.removeEvents(),i.on("play",this.impressionHandler,this),i.on("play",this.playHandler,this),i.on("complete",this.combinedCompleteHandler,this),i.on("click",this.clickStaticHandler,this),i.on("error",this.staticErrorHandler,this),this.playlistItemManager.addStaticOffset(this.scheduledAd._offSet),i.playAd(e.file,t,e.minDuration,this.scheduledAd._currentTag,this.scheduledAd.requestTimeout),this.clearBlocking()},o.prototype.creativeAdError=function(e,t,i){this.adError(e,t,i),this.adPodItems&&this.adPodItems.length-1>this.scheduledAd._adPodIndex&&(this.vpaidPlayer&&(this.vpaidPlayer.destroy(),this.vpaidPlayer=null),this.scheduledAd._adPodIndex++,this.playAd())},o.prototype.playVpaid=function(e){var t=this;clearTimeout(this.creativeTimeout),this.creativeTimeout=setTimeout(function(){t.creativeAdError("VPAID tag communication timeout",900,50004)},this.scheduledAd.creativeTimeout);var i=D(this.vastAd=e),r=this.optionalParams.conditionaladoptout&&e.conditionalAd;if(this.vastAd.selectedMedia=i,this.mediaType=i.type,"flash"===q(i))return this.creativeAdError("Flash creatives are not supported",403,10403),Promise.reject();var n={adParams:this.vastAd.adParams,vpaidControls:this.optionalParams.vpaidcontrols,adOptOut:r};return this.vpaidPlayer=new I(this.player,this.blockingInstreamPlayer,i.file,this.scheduledAd._currentTag,n),this.blockingInstreamPlayer&&this.blockingInstreamPlayer.applyProviderListeners(this.vpaidPlayer),this.vpaidPlayer.on("play",this.playHandler,this),this.vpaidPlayer.on("pause",this.pauseHandler,this),this.vpaidPlayer.on("quartile",this.quartileHandler,this),this.vpaidPlayer.on("remainingTimeChange",this.remainingTimeHandler,this),this.vpaidPlayer.on("click",this.clickVpaidHandler,this),this.vpaidPlayer.on("error",this.playbackErrorHandler,this),this.vpaidPlayer.on("impression",this.impressionHandler,this),this.vpaidPlayer.on("expandedChange",this.vpaidExpandedHandler,this),this.vpaidPlayer.on("close",this.adCloseHandler,this),this.vpaidPlayer.on("skipped",this.vpaidAdSkipped,this),this.vpaidPlayer.on("stopped",this.endOfVpaidAdHandler,this),this.vpaidPlayer.on("complete",this.adCompleteHandler,this),this.vpaidPlayer.on("started",this.adStartedHandler,this),this.setupSkipButton(e),Promise.resolve()},o.prototype.setupSkipButton=function(e){var t=this.player.utils,i=this.getSkipOffset(e);0<=i&&this.blockingInstreamPlayer&&(this.blockingInstreamPlayer.off(h,this.skipVpaidAd,this),this.blockingInstreamPlayer.setupSkipButton(i,this.optionalParams,t.noop),this.blockingInstreamPlayer.on(h,this.skipVpaidAd,this))},o.prototype.playInstream=function(e,t){var i=this,r=this.player.getEnvironment().OS;if(r.android&&2===r.version.major&&3===r.version.minor)return this.adError("Android 2.3 not supported",900,60007),Promise.reject();clearTimeout(this.creativeTimeout),this.creativeTimeout=setTimeout(function(){i.creativeAdError("Video creative timeout",402,10402)},this.scheduledAd.creativeTimeout),this.blockingInstreamPlayer?this.instreamPlayer=this.blockingInstreamPlayer:this.instreamPlayer=this.player.createInstream().init(),this.instreamPlayer.on("play",this.playHandler,this),this.instreamPlayer.on("pause",this.pauseHandler,this),this.instreamPlayer.on("time",this.timeHandler,this),this.instreamPlayer.on("playlistItem",this.playlistItemHandler,this),this.instreamPlayer.on("complete",this.adCompleteHandler,this),this.instreamPlayer.on("playlistComplete",this.endOfAdBreakHandler,this),this.instreamPlayer.on("mute",this.muteHandler,this),this.instreamPlayer.on("instreamClick",this.clickInstreamHandler,this),this.instreamPlayer.on("adSkipped",this.adSkipped,this),this.instreamPlayer.on("error",this.playbackErrorHandler,this),this.instreamPlayer.on("mediaError",this.playbackErrorHandler,this),this.instreamPlayer.on("destroyed",function(){i.instreamPlayer=null},this);var n=this.instreamPlayer.loadItem(e,t);return this.clearBlocking(),n},o.prototype.playerFullscreenHandler=function(e){var t=this.getVastAd().tracker;e.fullscreen&&t.started&&t.fullscreen()},o.prototype.playerResizeHandler=function(e){this.vpaidPlayer&&this.vpaidPlayer.resize(e.width,e.height)},o.prototype.playerVolumeHandler=function(e){this.vpaidPlayer&&this.vpaidPlayer.setVolume(e.volume)},o.prototype.playlistItemHandler=function(e){this.instreamPlayer&&(this.scheduledAd._adPodIndex=e.index+this.initialIndex,0<this.scheduledAd._adPodIndex&&this.triggerEvent(me))},o.prototype.impressionHandler=function(e){var t=this.getVastAd(),i=t.tracker;i.impression();var r=ke({},this.scheduledAd,t);this.triggerEvent(he,be(this.playlistItemManager,r,{duration:e.duration||t.duration||this.getDurationFromVideoTag(),linear:e.linear||i.linear})),this.setupViewableListener()},o.prototype.getDurationFromVideoTag=function(){var e=this.blockingInstreamPlayer?this.blockingInstreamPlayer.getMediaElement():null;return e?e.duration:0},o.prototype.setupViewableListener=function(){this.player.off(r,this.viewableHandler,this),this.player.on(r,this.viewableHandler,this),this.viewableHandler({viewable:this.player.getViewable()})},o.prototype.viewableHandler=function(e){e.viewable?(this.viewablePlayedTime=0,this.lastPosition=null,this.adViewableImpressionHandler=this.adViewableHandler):this.adViewableImpressionHandler=this.player.utils.noop},o.prototype.playHandler=function(e){var t=this;clearTimeout(this.creativeTimeout),this.creativeTimeout=null;var i,r=this.getVastAd(),n=r.tracker;if(n.started)e.oldstate===c&&(n.resume(),this.dispatchPlay(e));else{this.vpaidPlayer&&(n.linear=e.linear),this.instreamPlayer&&this.impressionHandler({linear:n.linear});var a=ke({},this.scheduledAd,r),s=be(this.playlistItemManager,a,{linear:n.linear,metadata:!0});if(this.triggerEvent(p,s),r.companions){var o=be(this.playlistItemManager,a,{companions:(i=r.companions,i.map(function(e){var t="iframe"===e.type||"html"===e.type?e.type:"static",i=void 0;return e.trackers&&e.trackers.creativeView&&e.trackers.creativeView.length&&(i=e.trackers.creativeView),{width:e.width,height:e.height,type:t,resource:e.source,creativeview:i,click:e.clickthrough}}))});this.triggerEvent("adCompanions",o)}r.icons&&(r.iconInstances=r.icons.map(function(e){return new H(t.player,e,t.div)}));var d=this.companion,l=void 0;l=9<this.player.utils.flashVersion()?r.companions:function(e){if(e)return e.filter(function(e){return e.type.indexOf("flash")<0});return[]}(r.companions),this.optionalParams.companion&&l&&l.length&&(n.hasComp=d.addCompanion(this.optionalParams.companion,l)),n.start(),n.creativeView(),this.dispatchPlay(e)}},o.prototype.dispatchPlay=function(e){"static"===this.adType||"vpaid"===this.adType&&"linear"!==e.linear||(null===this.reason&&"vpaid"===this.adType&&(this.reason=f),this.setState(e))},o.prototype.pauseHandler=function(e){clearTimeout(this.creativeTimeout),this.creativeTimeout=null,this.getVastAd().tracker.pause(),null===this.reason&&"vpaid"===this.adType&&(this.reason=f),this.setState(e)},o.prototype.setState=function(e){var t=e.newstate,i=t===oe,r=this.adEventObject(i?l:s);(r.newstate=t,null!==this.reason)&&(r[i?"playReason":"pauseReason"]=this.reason,this.reason=null);this.vpaidPlayer?this.vpaidPlayer.trigger("state",r):this.instreamPlayer.setEventData(r)},o.prototype.remainingTimeHandler=function(e){var t=this;e.duration?this.duration=e.duration:this.duration=Math.max(1,this.duration,e.remainingTime);var i=0<=e.remainingTime?this.duration-e.remainingTime:0;this.position===i?this.creativeTimeout=this.creativeTimeout||setTimeout(function(){t.creativeAdError("Video stall",400)},this.scheduledAd.creativeTimeout):this.creativeTimeout&&(clearTimeout(this.creativeTimeout),this.creativeTimeout=null),this.timeHandler({position:i,duration:this.duration,isDurationChange:e.isDurationChange})},o.prototype.quartileHandler=function(e){if(e.duration)this.duration=e.duration;else{var t=4*e.remainingTime/(4-e.quartile);this.duration=Math.max(this.duration,1,t)}this.timeHandler({position:this.duration*e.quartile*.25,duration:this.duration})},o.prototype.adViewableHandler=function(e){var t=e.position;null===this.lastPosition&&(this.lastPosition=t);var i=t-this.lastPosition;this.lastPosition=t,i=Math.min(Math.max(0,i),4),this.viewablePlayedTime+=i,2<=this.viewablePlayedTime&&(this.player.off(r,this.viewableHandler,this),this.adViewableImpressionHandler=this.player.utils.noop,this.triggerEvent("adViewableImpression",{}))},o.prototype.timeHandler=function(e){var t=this.getVastAd(),i=e.position,r=e.duration;this.adViewableImpressionHandler(e);var n=r-i,a=t.tracker,s=this.optionalParams.dynamicMessage||"",o=this.optionalParams.podMessage||"";if(s&&0<n){if(s=s.replace(/(\b)xx(s?\b)/gi,"$1"+Math.ceil(n)+"$2"),this.adPodItems&&1<this.adPodItems.length&&o){var d=this.scheduledAd._adPodIndex+1;s=(o=(o=o.replace(/__AD_POD_CURRENT__/g,""+d)).replace(/__AD_POD_LENGTH__/g,""+this.adPodItems.length))+" "+s}this.instreamPlayer?this.instreamPlayer.setText(s):this.vpaidPlayer&&this.vpaidPlayer.instream&&this.vpaidPlayer.instream.setText(s)}if(!e.isDurationChange){a&&a.time(i,r),t.iconInstances&&t.iconInstances.forEach(function(e){e.updateTime(i)});var l={};l.position=this.position=i,l.duration=r,this.triggerEvent("adTime",l)}},o.prototype.combinedCompleteHandler=function(){this.adCompleteHandler(),this.endOfAdBreakHandler()},o.prototype.adCompleteHandler=function(){clearTimeout(this.viewableTimeout);var e=this.getVastAd();N(e);var t=e.tracker;t.firedError||(t.complete(),this.triggerEvent(i))},o.prototype.adCloseHandler=function(){clearTimeout(this.viewableTimeout);var e=this.getVastAd().tracker;e.firedError||e.close()},o.prototype.adStartedHandler=function(){this.triggerEvent(t)},o.prototype.endOfVpaidAdHandler=function(){if(clearTimeout(this.viewableTimeout),this.adPodItems&&this.adPodItems.length-1>this.scheduledAd._adPodIndex)return this.vpaidPlayer&&(this.vpaidPlayer.destroy(),this.vpaidPlayer=null),this.scheduledAd._adPodIndex++,void this.playAd();this.endOfAdBreakHandler()},o.prototype.endOfAdBreakHandler=function(){this.removePlayerListeners(),this.trigger(ve)},o.prototype.muteHandler=function(e){var t=this.getVastAd().tracker;t&&(e.mute?t.mute():t.unmute(),this.vpaidPlayer&&this.vpaidPlayer.setVolume(e.mute?0:this.player.getVolume()))},o.prototype.clickStaticHandler=function(){var e=this.getVastAd();this.player.pause({reason:m}),this.clickThrough(e)},o.prototype.clickVpaidHandler=function(e){var t=this.getVastAd(),i=!0;e&&void 0!==e.url&&(!1===e.playerHandles&&(i=!1),t.clickthrough=e.url),this.clickThrough(t,i)},o.prototype.clickInstreamHandler=function(){this.instreamPlayer.getState()!==c&&this.clickThrough(this.getVastAd())},o.prototype.clickThrough=function(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];e.tracker.click();var i={};e.clickthrough&&(i.clickThroughUrl=e.clickthrough),this.reason=m,this.triggerEvent(a,i),window.jwcast&&window.jwcast.player.id||e.clickthrough&&t&&window.open(e.clickthrough)},o.prototype.skipVpaidAd=function(){this.vpaidPlayer&&this.vpaidPlayer.skip()&&this.vpaidAdSkipped()},o.prototype.vpaidAdSkipped=function(){this.adSkipped(),this.endOfVpaidAdHandler()},o.prototype.adSkipped=function(){clearTimeout(this.viewableTimeout);var e=this.getVastAd();e.tracker.skip(),N(e);var t=this.getSkipOffset(e);this.triggerEvent(h,{duration:e.duration,skipoffset:t,position:this.position,watchedPastSkipPoint:this.position-t})},o.prototype.playbackErrorHandler=function(e){var t=e.message||"Error Playing Ad Tag",i=e.code;i&&232404===i?i=403:(!i||i<=4||901<i)&&(i=405),this.vpaidPlayer&&"function"==typeof this.vpaidPlayer.off?(this.vpaidPlayer.off(),this.creativeAdError(t,i,e.adErrorCode)):this.adError(t,i,e.adErrorCode)},o.prototype.staticErrorHandler=function(){this.adError("Unable to fetch NonLinear resource",502)},o.prototype.vpaidExpandedHandler=function(e){var t=this.getVastAd().tracker;e.expanded?t.expand():t.collapse()},o.prototype.triggerEvent=function(e,t){var i=this.adEventObject(e);t&&ke(i,t),this.trigger(e,i),-1===A.indexOf(e)&&this.player.trigger(e,i)},o}();function q(e){return"application/javascript"===(t=e).type||"application/x-javascript"===t.type?"html5":"flash";var t}function D(e){for(var t=void 0,i=0;i<e.media.length;i++){var r=e.media[i];if("html5"===q(r)){t=r;break}}return t}function F(e,t,i,r){e.tracker=new B(e.trackers,t,i,r)}function N(e){e&&e.iconInstances&&(e.iconInstances.forEach(function(e){e.remove()}),e.iconInstances=null)}var Ie=function(){function r(e,t,i){b(this,r),this.debugTrackFn=e,this.div=null,this.elem=null,this.environment=t,this.utils=i}return r.prototype.addCompanion=function(e,t){if(this.div=e,this.elem=document.getElementById(this.div.id),!this.elem)return!1;for(var i=0;i<t.length;i++)if(this.fitsDiv(t[i]))return this.placeCompanion(t[i]),!0;return!1},r.prototype.removeCompanion=function(){this.elem.innerHTML=""},r.prototype.sendPings=function(e){(e=e.creativeView)&&(e.forEach(function(e){(new Image).src=e}),"function"==typeof this.debugTrackFn&&this.debugTrackFn({type:"companion",data:{trackers:e}}))},r.prototype.placeCompanion=function(e){var t=this;if(this.removeCompanion(),"html"===e.type){var i=document.createElement("div");i.innerHTML=e.source;var r=i.getElementsByTagName("script");return r.length&&r.forEach(function(e){new t.utils.scriptloader(e.src).load(),e.parentElement.removeChild(e)}),this.elem.appendChild(i),void this.sendPings(e.trackers)}if("iframe"===e.type){var n=document.createElement("iframe");return n.height=this.div.height,n.width=this.div.width,n.src=e.source,n.scrolling="no",n.style.border="none",n.marginWidth=0,n.marginHeight=0,this.sendPings(e.trackers),this.elem.innerHTML="",void this.elem.appendChild(n)}if("application/x-shockwave-flash"===e.type){var a=document.createElement("object");return a.setAttribute("type","application/x-shockwave-flash"),a.setAttribute("data",e.source),a.setAttribute("width","100%"),a.setAttribute("height","100%"),a.setAttribute("tabindex",0),U(a,"allowfullscreen","true"),U(a,"allowscriptaccess","always"),U(a,"seamlesstabbing","true"),U(a,"wmode","opaque"),this.elem.appendChild(a),void this.sendPings(e.trackers)}var s=new Image;s.src=e.source,e.clickthrough&&(s.onclick=function(){t.utils.openLink(e.clickthrough,"_blank",{rel:"noreferrer"})}),this.elem.innerHTML="",this.elem.appendChild(s),this.sendPings(e.trackers)},r.prototype.fitsDiv=function(e){return e.width===this.div.width&&e.height===this.div.height},r}();function U(e,t,i){var r=document.createElement("param");r.setAttribute("name",t),r.setAttribute("value",i),e.appendChild(r)}var X=/^((https?:)?\/\/)?(secure)?pubads\.g\.doubleclick\.net\/gampad\/ads\?[\S]*$/;function Q(r,e,t){if(!r)return Promise.resolve(r);var i,n,a,s,o,d,l=(n=(i=e).getConfig(),a=i.getPlaylistItem()||{},{playerHeight:i.getHeight()||n.height||"",playerWidth:i.getWidth()||n.width||"",itemDuration:(s=i.getDuration(),o=3,d=Math.pow(10,o),Math.round(s*d)/d||""),item:a,jwpseg:Array.isArray(a.jwpseg)?a.jwpseg.join(","):"",placement:L(n)}),u=l.item,c=j();r=W(r=W(r=W(r=W(r=W(r=W(r=W(r=W(r=W(r=W(r,"__random-number__",Math.random()*Math.pow(10,18)),"__timestamp__",(new Date).getTime()),"__page-url__",encodeURIComponent(c.url)),"__referrer__",encodeURIComponent(c.referrer)),"__player-height__",l.playerHeight),"__player-width__",l.playerWidth),"__item-duration__",l.itemDuration),"__jwpseg__",l.jwpseg),"__domain__",encodeURIComponent(c.domain)),"__placement__",l.placement);for(var p=(r=t.companion?W(r,"__companion-div__",t.companion.id):W(r,"__companion-div__","")).match(new RegExp(/__item-[a-z 0-9 A-Z]*__/g)),h=0;p&&h<p.length;h++){var m=p[h],f=m.substring(7,m.length-2);if(u.hasOwnProperty(f)&&"string"==typeof u[f]){var v=u[f];1e3<v.length&&(v=v.substring(0,1e3)),r=W(r,m,encodeURIComponent(v))}else r=W(r,m,"")}var g=e.getConfig().autostart?1:0,y=e.getMute()?1:0;return-1!==(r=function(e,t,i){X.test(e)&&(e=e+"&vpa="+t+"&vpmute="+i);return e}(r,g,y)).indexOf("__gdpr__")||-1!==r.indexOf("__gdpr_consent__")?M().then(function(e){var t=e.gdprApplies,i=e.consentData;return W(r=W(r,"__gdpr__",t?1:0),"__gdpr_consent__",i)}).catch(function(){return r}):Promise.resolve(r)}function W(e,t,i){return e.replace(t,i)}var z=Array.prototype,$=z.forEach,J=z.map;function K(e,t,i){e.push({message:t,code:1002,adErrorCode:11002,id:i})}function Ee(){var e=new Error("No AdBreaks in VMAP");throw e.adErrorCode=60005,e}var Ce=function(){function i(e,t){b(this,i),this.utils=t,this._error=null,this._version=null,e&&this.parse(e)}return i.prototype.error=function(){return this._error},i.prototype.version=function(){return this._version},i.prototype.parse=function(i,r){var n=this,e=void 0;"VAST"===i.nodeName?e=i:(e=Se(i,"VAST"))||(e=Se(i,"VideoAdServingTemplate")),e||this.throwError(101,"Invalid VAST response");var a="VideoAdServingTemplate"===e.tagName?1:parseFloat(xe(e,"version")||0);this._version=a;var t,s=Re(e,"Ad"),o=J.call(s,function(e){var t=n.parseAd(a,e);return t.vastversion=a,t.response=i,t.request=r||null,t});return o.length||(t=Re(e,"Error"),$.call(t,function(e){var t=je(e).replace(d,303),i=new Image;i.src=t})),o},i.prototype.parseAd=function(e,t,i){i=i||{};var r,n,a=Se(t,"InLine"),s=Se(t,"Wrapper"),o=a||s,d=o?je(Se(o,"AdTitle")):"",l=void 0;return i.sequence=xe(t,"sequence"),i.adId=xe(t,"id"),i.adTitle=d,i.description=je(Se(o,"Description")),(!e||4.2<e||e<2)&&this.throwError(102,"Vast version not supported"),4<=e&&(i.conditionalAd=!!xe(t,"conditionalAd")),o?(Oe(o,"Impression",(l=function(e,b,T){var t=Re(Se(e,"Creatives"),"Creative"),I={},E={trackers:I};E.adsystem=je(Se(e,"AdSystem"));var i=Re(e,"Category");return E.categories=J.call(i,function(e){return je(e)}),$.call(t,function(e){var t=Se(e,"Linear"),i=Se(e,"NonLinear"),r=Re(Se(e,"TrackingEvents"),"Tracking");if(4<=b){var n=Re(e,"UniversalAdId");E.universalAdId=J.call(n,function(e){return{universalAdIdRegistry:xe(e,"idRegistry")||"unknown",universalAdIdValue:je(e)||xe(e,"idValue")||"unknown"}})}E.creativeId=xe(e,"id"),E.creativeAdId=xe(e,"adId"),(t||i)&&$.call(r,function(e){Me(I,e)});var a,s,l,o,d,u,c,p,h,m,f,v,g=je(Se(e,"AdParameters"));if(g&&(E.adParams=g),t){var y=Se(t,"VideoClicks"),A=je(Se(y,"ClickThrough")),w=Re(y,"ClickTracking"),k=xe(t,"skipoffset"),P=je(Se(t,"Duration"));$.call(w,function(e){Le(I,"click",je(e))}),P&&(E.duration=T.seconds(P)),A&&(E.clickthrough=A),k&&(E.skipoffset=k),m=E,f=Re(Se(t,"MediaFiles"),"MediaFile"),v=m.media?m.media:[],m.media=v.concat(J.call(f,function(e){return{type:xe(e,"type"),file:je(e),adType:xe(e,"apiFramework")||"",width:parseInt(xe(e,"width"),10)||0,height:parseInt(xe(e,"height"),10)||0}}).filter(function(e){return e.file})),p=E,h=Re(t,"Icon"),p.icons=Array.prototype.reduce.call(h,function(e,t){var i=void 0,r=void 0;if(i=Se(t,"StaticResource"))r=xe(i,"creativeType");else if(i=Se(t,"IFrameResource"))r="iframe";else{if(!(i=Se(t,"HTMLResource")))return e;r="html"}var n=je(i),a={};a.iconClick=je(Se(t,"IconClickTracking"))||null,a.iconView=je(Se(t,"IconViewTracking"))||null;var s=xe(t,"xPosition"),o=xe(t,"yPosition"),d={};return"left"===s||"right"===s?d[s]=0:d.left=parseInt(s,10)||0,"top"===o||"bottom"===o?d[o]=0:d.top=parseInt(o,10)||0,d.width=parseInt(xe(t,"height"),10)||0,d.height=parseInt(xe(t,"height"),10)||0,e.push({program:xe(t,"program"),style:d,apiFramework:xe(t,"apiFramework"),offset:xe(t,"offset")||"00:00:00",duration:xe(t,"duration")||null,clickThrough:je(Se(t,"IconClickThrough")),trackers:a,resource:{resourceType:r,resourceSource:n}}),e},p.icons||[])}else if(i){var _=je(Se(i,"NonLinearClickThrough"));_&&(E.clickthrough=_),d=E,u=[],(c=Se(o=e,"StaticResource"))&&(u.push({type:xe(c,"creativeType"),file:je(c),adType:xe(Se(o,"NonLinear"),"apiFramework")||"static",minDuration:xe(Se(o,"NonLinear"),"minSuggestedDuration")||"00:00:00"}),d.media=u)}else a=E,s=Re(Se(e,"CompanionAds"),"Companion"),l=a.companions?a.companions:[],$.call(s,function(e){var t=Se(e,"StaticResource"),i=Se(e,"IFrameResource"),r=Se(e,"HTMLResource"),n={},a=void 0,s=void 0;if(t)a=xe(t,"creativeType"),s=je(t);else if(i)a="iframe",s=je(i);else{if(!r)return;a="html",s=je(r)}var o=Re(Se(e,"TrackingEvents"),"Tracking");$.call(o,function(e){var t=xe(e,"event");Le(n,t,je(e))});var d=je(Se(e,"CompanionClickThrough"));l.push({width:parseInt(xe(e,"width"),10),height:parseInt(xe(e,"height"),10),type:a,source:s,trackers:n,clickthrough:d})}),a.companions=l}),E}(o,e,this.utils)).trackers),Oe(o,"Error",l.trackers),function(i){var r={};i.media&&i.media.forEach(function(e){var t=e.type,i="application/x-mpegURL"===t||"vnd.apple.mpegURL"===t;"vpaid"===e.adType.toLowerCase()||i||(r[t]=r[t]||0,r[t]++)});i.mediaFileCompliance=!0,Object.keys(r).forEach(function(e){var t=r[e];t<3&&(i.mediaFileCompliance=!1,i.nonComplianceReasons=i.nonComplianceReasons||[],i.nonComplianceReasons.push(e+" has only "+t+" qualities"))})}(l),s&&(l.wrappedURI=je(Se(s,"VASTAdTagURI"))||je(Se(s,"VASTAdTagURL")),l.followAdditionalWrappers=JSON.parse(xe(s,"followAdditionalWrappers")),l.allowMultipleAds=JSON.parse(xe(s,"allowMultipleAds")),l.fallbackOnNoAd=JSON.parse(xe(s,"fallbackOnNoAd"))),r=l,n=ke({},i),Object.keys(r).forEach(function(e){var t=r[e];Array.isArray(n[e])?n[e]=n[e].concat(t):"object"==typeof n[e]&&null!==n[e]?n[e]=ke(n[e],t):n[e]=t}),l=n):this.throwError(303,"No ads",10303),l},i.prototype.throwError=function(e,t,i){throw this._error=new Error(t),this._error.code=e,this._error.adErrorCode=i||1e4+e,this._error},i}();function Re(e,t,i){var r=[];return e&&(r=e.getElementsByTagName(t),i&&r&&0===r.length&&(r=e.getElementsByTagName(i+":"+t))),r}function Se(e,t){if(e){var i=e.getElementsByTagName(t);if(i)return i[0]}return null}function xe(e,t){return e?e.getAttribute(t):null}function Me(e,t){var i=xe(t,"event");"progress"===i&&(i=i+"_"+xe(t,"offset"));Le(e,i,je(t))}function je(e){if(e){var t=e.textContent||e.text;if(t)return O(t)}return""}function Le(e,t,i){e[t]||(e[t]=[]),i&&e[t].push(i)}function Oe(e,t,i){var r=Re(e,t);J.call(r,function(e){Le(i,t.toLowerCase(),je(e))})}function Ve(e){e.onload=e.onreadystatechange=e.onerror=null,"abort"in e&&e.abort()}var Be=function(){function i(e,t){b(this,i),this.adRules=e,this.utils=t,this.preRoll=null,this.vmap=null,this.postRoll=null,this.midRolls=[],this.playedMidRolls=[],this.duration=0,this._vmapPromise=null,this._vmapXHR=null}return i.prototype.load=function(s,e){var o=this;if(this._vmapPromise)return this._vmapPromise;null!==this._vmapXHR&&(Ve(this._vmapXHR),this._vmapXHR=null);var t=Q(this.getVMAP(),s,e);return this._vmapPromise=t.then(function(a){return new Promise(function(e,n){o._vmapXHR=s.utils.ajax({url:a,withCredentials:!0,retryWithoutCredentials:!0,requireValidXML:!0,timeout:o.requestTimeout},e,function(e,t,i,r){return n(r)})}).then(function(e){return o._vmapXHR=null,function(e,t,i){var r=[],n=Re(e,"VMAP",C);if(!n.length)throw new Error("No VMAP tag in response");xe(n[0],"version")||K(r,"VMAP Schema Error: version missing from VMAP tag",G);var a=Re(e,"AdBreak",C);a.length||Ee();for(var s=e.lookupNamespaceURI(C),o=0;o<a.length;o++){var d={},l={},u=a[o],c=xe(u,"timeOffset"),p=xe(u,"breakId"),h=xe(u,"breakType"),m=xe(Re(u,"AdSource",C)[0],"id"),f=Re(u,"AdTagURI",C)[0],v=Re(u,"VASTData",C)[0]||Re(u,"VASTAdData",C)[0],g=xe(f,"templateType"),y=je(f),A=(b=u,T="Tracking",I=C,E=void 0,E=[],(_=s)||b?E=b.getElementsByTagNameNS?b.getElementsByTagNameNS(_,T):b.getElementsByTagName(I+":"+T):E);if(h||K(r,"VMAP Schema Error: missing breakType on AdBreak",p),v||g||K(r,"VMAP Schema Error: missing templateType on AdBreak",p),c||K(r,"VMAP Schema Error: missing timeOffset on AdBreak",p),d._type=h,d._vmap={id:m,breakid:p,timeoffset:c},v)d._adXML=Se(v,"VAST");else{if("vast2"!==g&&"vast3"!==g&&"vast4"!==g)continue;d._adQueue=[y],d._waterfallIndex=0}var w=[];if(A)for(var k=0;k<A.length;k++){Me(l,A[k]);var P=xe(A[k],"event");w.push(P)}switch((w.indexOf("breakStart")<0||w.indexOf("breakEnd")<0||w.indexOf("error")<0)&&K(r,"Tracking events are missing breakStart, breakEnd, or error for AdBreak",p),d._trackers=l,d._type=h,c){case"start":d._offSet="pre",t.setPreRoll(d);break;case"100%":case"end":d._offSet="post",t.setPostRoll(d);break;default:if(/^#/.test(c))break;/^\d\d?(?:\.\d+)?%$/.test(c)?d._offSet=c:d._offSet=i.seconds(c),t.addMidRoll(d)}}var _,b,T,I,E;return t.preRoll||t.midRolls.length||t.postRoll||Ee(),t.sort(null,!0),r}(e.responseXML,o,s.utils).map(function(e){return ke(e,{vmap:a})})}).catch(function(e){o._vmapXHR=null;var t={id:G,vmap:a};if(e.message)ke(t,{message:"VMAP Schema Error: "+e.message,code:1002,adErrorCode:e.adErrorCode||11002});else{var i={1:{code:1007,message:"Timeout"},602:{code:1e3,message:"Invalid XML"},default:{code:1008,message:s.getConfig().localization.errors[e.key]}},r=i[e.code]||i.default;s.utils.log(r.message),ke(t,{message:"Error Loading VMAP Schedule",code:r.code,adErrorCode:r.code+1e4})}throw t})}),this._vmapPromise},i.prototype.canWaterfall=function(e){return e._adQueue&&e._waterfallIndex+1<e._adQueue.length},i.prototype.getPreRoll=function(e){return e&&"none"===this.adRules.startOnSeek?null:He(this.preRoll,this.requestTimeout,this.creativeTimeout)},i.prototype.getPostRoll=function(e){var t=He(this.postRoll,this.requestTimeout,this.creativeTimeout);return this.adRules.timeBetweenAdsAllowsAdPlayback(t,e)?t:null},i.prototype.getMidRollAtIndex=function(e){return He(this.midRolls[e],this.requestTimeout,this.creativeTimeout)},i.prototype.getLastMidRollIndexBetweenTime=function(e,t,i){if(t<e)return null;this.sort(i);for(var r=this.midRolls.length;r--;){var n=this.midRolls[r],a=qe(this.midRolls[r]._offSet,i);if(a<=e)return null;if(a<=t){var s=He(n,this.requestTimeout,this.creativeTimeout);if(!this.adRules.timeBetweenAdsAllowsAdPlayback(s))return null;if(!this.adRules.timeBetweenAds){if(0<=this.playedMidRolls.indexOf(r))return null;this.playedMidRolls.push(r)}return r}}return null},i.prototype.peek=function(e,t,i){if(this.midRolls.length>this.playedMidRolls.length){this.sort(i);for(var r=0;this.midRolls[r];){var n=qe(this.midRolls[r]._offSet,i);if(e<=n&&-1===this.playedMidRolls.indexOf(r)){var a=Pe()+1e3*(n-e);return n<=t&&this.adRules.timeBetweenAdsAllowsAdPlayback(null,a)?r:null}r+=1}}var s=Pe()+1e3*(i-e);return this.postRoll&&i<=t&&this.adRules.timeBetweenAdsAllowsAdPlayback(null,s)?-1:null},i.prototype.getNextMidrollIndex=function(e,t,i){if(this.adRules.timeBetweenAds||this.adRules.startOnSeek)return this.getLastMidRollIndexBetweenTime(e,t,i);if(this.midRolls.length>this.playedMidRolls.length){var r=this.getClosestIndex(t,i);if(0<=r&&this.playedMidRolls.indexOf(r)<0)return this.playedMidRolls.push(r),r}return null},i.prototype.getMidRolls=function(){var t=this;return this.midRolls.map(function(e){return He(e,t.requestTimeout,t.creativeTimeout)})},i.prototype.reset=function(){null!==this._vmapXHR&&(Ve(this._vmapXHR),this._vmapXHR=null),this.playedMidRolls=[],this.duration=0},i.prototype.resetBreakIdByOffset=function(e){if(e){var t=void 0;t="pre"===e?this.preRoll:"post"===e?this.postRoll:this.midRolls[e],this.resetBreakId(t)}},i.prototype.setPreRoll=function(e){this.resetBreakId(e),this.preRoll=e},i.prototype.addMidRoll=function(e){this.resetBreakId(e),this.midRolls.push(e),this.duration=0},i.prototype.setPostRoll=function(e){this.resetBreakId(e),this.postRoll=e},i.prototype.sort=function(i,e){(!i||i<1)&&(i=1),(this.duration!==i||e)&&(this.duration=i,this.midRolls.sort(function(e,t){return qe(e._offSet,i)-qe(t._offSet,i)}),function(e,t){for(var i=0;i<e.length;i++){var r=e[i];t?r._vmap.item=i+1:(r._adbreak={item:i+1,breakid:r._breakId},r._pod?r._adbreak.pod=r._pod:r._adbreak.tags=r._adQueue)}}(this.getAllAds(),e))},i.prototype.getAllAds=function(){var e=this.preRoll?[this.preRoll]:[],t=this.postRoll?[this.postRoll]:[];return e.concat(this.midRolls,t)},i.prototype.setVMAP=function(e){this.vmap=e},i.prototype.isVMAP=function(){return!!this.vmap},i.prototype.getVMAP=function(){return this.vmap},i.prototype.getClosestIndex=function(e,t){this.sort(t);for(var i=this.midRolls.length;i--;)if(e>=qe(this.midRolls[i]._offSet,t))return i;return-1},i.prototype.resetBreakId=function(e){e.adBreakId=this.utils.genId(12)},i}();function He(i,e,t){if(null!==i){var r=void 0;return Object.keys(i).forEach(function(e){var t=i[e];(r=r||{})[e]="_adQueue"===e||"_pod"===e?t.slice():t}),r?(r.requestTimeout=e,r.creativeTimeout=t,r._errors=[],r._waterfallIndex=0,r._adPodIndex=0,r):void 0}}function qe(e,t){return"%"===e.toString().slice(-1)?t*parseFloat(e.slice(0,-1))/100:parseFloat(e)}var De=function(){function t(e){b(this,t),this.utils=e}return t.prototype.getSchedule=function(e,t){var i=new Be(t,this.utils);if(i.requestTimeout=Ne(e.requestTimeout,ee),i.creativeTimeout=Ne(e.creativeTimeout,te),e.tag)i.setPreRoll({_offSet:"pre",_adQueue:Fe(e.tag),_waterfallIndex:0});else if("string"==typeof e.vastxml)i.setPreRoll({_offSet:"pre",_adXML:e.vastxml});else{if("string"==typeof e.schedule)return i.setVMAP(e.schedule),i;if("string"==typeof e.adschedule)return i.setVMAP(e.adschedule),i;!function(i,r,u){var c=r.schedule||r.adschedule;if(!c)return;var p={};Object.keys(c).forEach(function(e){var t=c[e];t.ad&&(ke(t,t.ad),delete t.ad);var i=function(e,t){if("start"===e||"0%"===e||!e&&0!==e)return"pre";if("end"===e||"100%"===e)return"post";if("pre"===e||"post"===e||0<=(e+"").indexOf("%"))return e;var i=t.seconds(e);if("number"==typeof i)return i;return!1}(t.offset,u),r=Ne(t.requestTimeout,ee),n=Ne(t.creativeTimeout,te),a=p[i];if(a){if("nonlinear"===t.type)return;"nonlinear"===a._type&&(a=null)}var s=p[i]=a||{_offSet:i,_type:t.type,_breakId:e,requestTimeout:r,creativeTimeout:n};!1===i&&u.log("Error: ad offset format not supported",i);var o=t.skipoffset;if(void 0!==o&&void 0===s.skipoffset&&(s.skipoffset=o),t.pod){var d=s._pod||[];s._pod=d.concat(t.pod)}else if(t.tag){var l=function(e,i){if(!i)return e;var t=0<=e.indexOf("?")?"&":"?",r="cust_params=",n=e.indexOf(r),a=r.length,s="",o="";if(Object.keys(i).forEach(function(e){var t=i[e];s=""+s+o+e+"="+t,o="&"}),s=encodeURIComponent(s),0<=n){var d=e.substr(0,n+a),l=e.substr(n+a);return""+d+s+"%26"+l}return""+e+t+"cust_params="+s}(t.tag,t.custParams);s._adQueue&&(s._pod=[s._adQueue[0]],delete s._adQueue),s._pod?s._pod.push(Fe(l)[0]):s._adQueue=Fe(l)}else{if("string"!=typeof t.vastxml)return void u.log("Error: no ad tag provided");s._adXML=t.vastxml}}),Object.keys(p).forEach(function(e){var t=p[e];switch(t.skipoffset=t.skipoffset||r.skipoffset,e){case"pre":i.setPreRoll(t);break;case"post":i.setPostRoll(t);break;default:i.addMidRoll(t)}})}(i,e,this.utils)}return i.sort(),i},t.prototype.getOptParams=function(e,t){var i={cuetext:t.cuetext,dynamicMessage:t.admessage,loadingAd:t.loadingAd,podMessage:t.podmessage,skipoffset:e.skipoffset,skipMessage:t.skipmessage,skipText:t.skiptext,vpaidcontrols:e.vpaidcontrols||!1,conditionaladoptout:e.conditionaladoptout||!1,requestFilter:e.requestFilter,trackingFilter:e.trackingFilter},r=e.companiondiv;return r&&(i.companion={id:r.id,height:r.height,width:r.width}),i},t.prototype.getAdRules=function(e){var t=e.rules||{},i=parseInt(t.frequency,10);return{startOn:t.startOn||1,frequency:isNaN(i)?1:i,timeBetweenAds:t.timeBetweenAds||0,startOnSeek:t.startOnSeek||null}},t}();function Fe(e){return Array.isArray(e)?e.slice(0):[e]}function Ne(e,t){return 0===e?1/0:e||t}var Ue,Xe,Qe,We=function(){function d(e,t,i,r,n){b(this,d),this._scheduledAd=e,this.player=t,this.options=i||{},this.wrapperOptions=r||{followAdditionalAds:!0,allowMultipleAds:!0},this.debugTrackFn=n,ke(this,t.Events),this._history=[],this.loadedAds=[],this.parser=null,this.promise=null,this.xmlhttp=null,this.wrappedTags=null,this.options.isPodItemLoader||(e.adPlayIds={})}return d.prototype.load=function(t){var i=this;if(null===this.promise){this._history.push(t);var r=this.options.requestFilter;this.promise=new Promise(function(e,n){i.xmlhttp=i.player.utils.ajax({url:t,withCredentials:!0,retryWithoutCredentials:!0,requireValidXML:!0,timeout:i._scheduledAd.requestTimeout,requestFilter:r},e,function(e,t,i,r){return n(r)})}).catch(function(e){if(null!==i.player)throw i.ajaxError(e,t)}).then(function(e){if(null!==i.player)return i.parseXMLString(e.responseXML||e.responseText,t)})}return this.promise},d.prototype.destroy=function(){var e;(e=this.xmlhttp)&&(e.onload=null,e.onreadystatechange=null,e.onerror=null,e.abort&&e.abort()),this.player=null,this.xmlhttp=null},d.prototype.scheduledAd=function(){return this._scheduledAd},d.prototype.allAds=function(){return this.loadedAds},d.prototype.podMultipleVastLoaders=function(e){var a=this,t=e.map(function(e){return e.then(function(e){var t=e.adPod();if(t.length)return t;var i=e.adBuffet();return i.length?[i[0]]:Promise.reject({vloader:a,message:"No compatible ad"})}).catch(function(e){return{error:e}})});return Promise.all(t).then(function(e){var n=0,t=e.reduce(function(t,e,i){if(e.error)return e.error.tagIndex=i,a.trigger(ge,e.error),t;if(e.length&&0!==i){var r="p"+n+"w"+a._scheduledAd._waterfallIndex;a._scheduledAd.adPlayIds[r]=a._scheduledAd.adRequestIds[i]}return e.forEach(function(e){e.sequence=++n,t.push(e)}),t},[]);return t.length?(a.loadedAds=t,a):null})},d.prototype.adPod=function(){var t=[];return this.loadedAds.forEach(function(e){e.sequence&&t.push(e)}),t.sort(function(e,t){return e.sequence-t.sequence}),t},d.prototype.adBuffet=function(){var t=[];return this.loadedAds.forEach(function(e){e.sequence||t.push(e)}),t},d.prototype.parseXMLString=function(r,n){var o=this;return null===this.parser&&(this.parser=new Ce(null,this.player.utils)),new Promise(function(e){var t,i=(t=r,("object"==typeof Node?t instanceof Node:t&&"object"==typeof t&&"number"==typeof t.nodeType&&"string"==typeof t.nodeName)?r:o.player.utils.parseXML(r));if(null===i){throw{message:"Invalid XML",code:100}}return e(o.parser.parse(i,o.xmlhttp))}).catch(function(e){if(null!==o.player){var t=e.code||900,i=e.adErrorCode||1e4+t;throw o.sendErrorEvent(e.message,t,i,n)}}).then(function(e){if(null===o.player)return null;if(0===e.length)throw o.sendErrorEvent("No ads",303,10303,n);var a=e.filter(function(e){return!e.sequence}).map(function(e){return e._currentTag=n,e});o.wrapperOptions.allowMultipleAds?o.loadedAds=e:o.loadedAds=a,o.options.wrapper=o.options.wrapper||[],o.options.adsystem&&o.options.wrapper.push(o.options.adsystem),o.options.adsystem=o.loadedAds[0].adsystem;var t=[];return e.forEach(function(s,n){if(s.wrappedURI){if(!1===o.wrapperOptions.followAdditionalWrappers)return;o.options.wrappedTags=o.options.wrappedTags||[o._scheduledAd._currentTag],o.options.wrappedTags.push(s.wrappedURI);var e=new d(o._scheduledAd,o.player,o.options,{fallbackOnNoAd:s.fallbackOnNoAd,allowMultipleAds:s.allowMultipleAds,followAdditionalWrappers:s.followAdditionalWrappers},o.debugTrackFn).load(s.wrappedURI).then(function(e){var t,i,n,r=(t=s,i=e.allAds(),n=[],i.forEach(function(e){var i,r;t.companions&&(e.companions=(e.companions?e.companions:[]).concat(t.companions)),t.trackers&&(e.trackers=(i=e.trackers,r=t.trackers,i=i||{},Object.keys(r).forEach(function(e){var t=r[e];i[e]?i[e]=i[e].concat(t):i[e]=t}),i)),t.sequence&&(e.sequence=t.sequence),t._currentTag&&(e._currentTag=t._currentTag),n.push(e)}),n),a=o.loadedAds.indexOf(s);Array.prototype.splice.apply(o.loadedAds,[a,1].concat(r))}).catch(function(e){var t=o.sendAdpodErrorEvent(e,s,n),i=s.fallbackOnNoAd&&s.sequence&&a.length,r=o.loadedAds.indexOf(s);if(i)return s.loadError=t,void e.vloader.destroy();if(o.loadedAds.splice(r,1),e.vloader.destroy(),t.type!==ge)throw t;o.trigger(ge,t)});t.push(e)}else o.options.wrapper.length&&(s.wrapper=o.options.wrapper,s.wrappedTags=o.options.wrappedTags)}),Promise.all(t)}).then(function(){if(null===o.player)return null;var n=o.loadedAds.filter(function(e){return!e.sequence});o.loadedAds.forEach(function(e,t){if(e.loadError)if(n.length){var i=o.loadedAds[t+1],r=i&&!i.sequence?i:n[0];o.loadedAds[t]=ke({},r,{sequence:e.sequence})}else o.trigger(ge,e.loadError)});var t=o.loadedAds.slice(0),e=t.length;t.forEach(function(e){e.media&&e.media.length||t.length--});var i=0===e,r=t.length!==e;if(i||r)throw o.sendErrorEvent("Ad Tag Empty",101,10101,o._history[o._history.length-1]);return o})},d.prototype.ajaxError=function(e,t){if(this.player.getAdBlock())return this.sendErrorEvent("Ad playback blocked by an ad blocker",900,60003,t);var i=e.code;if(601===i||602===i)return this.sendErrorEvent("Invalid XML",100,10100,t);var r=this.options.wrappedTags&&this.options.wrappedTags.length,n=r?301:900,a=r?10301:60006;return this.sendErrorEvent(e.message||"Error loading file",n,a,t)},d.prototype.firstUrl=function(){return this._history&&this._history.length?this._history[0]:""},d.prototype.sendAdpodErrorEvent=function(e,t,i){var r=e.message,n=e.code,a=e.adErrorCode,s=e.url;if(1===this.loadedAds.length)return this.sendErrorEvent(r,n,a,s,i);var o={message:r,code:n,adErrorCode:a,podIndex:i,vloader:this,tag:this.firstUrl()||s,type:ge};return this.trackError(o,t),this.wrappedTags=s,o},d.prototype.sendErrorEvent=function(e,t,i,r,n){var a={message:e,code:t,adErrorCode:i,podIndex:n,vloader:this,tag:this.firstUrl()||r,adsystem:this.options.adsystem||""};return this.options.wrappedTags&&(a.wrapperAdSystem=this.options.wrapper||"",a.wrappedTags=this.options.wrappedTags),this.trackError(a),a},d.prototype.trackError=function(e,t){var i=e.vloader.allAds();if(i&&i.length){var r=t||i[0];if(r){var n=r.trackers;if(n&&n.error)new B(n,this.debugTrackFn,this.player,this.options.trackingFilter).error(e.code)}}},d}();var ze=2e3,$e=3500,Je="usd",Ke=1,Ge="//c.amazon-adsystem.com/aax2/apstag.js",Ye="video",Ze="3.0.0",et="//js-sec.indexww.com/htv/htv-jwplayer.min.js",tt="//js.spotx.tv/directsdk/v1/",it="//search.spotxchange.com/ad/vast.html?key=",rt="dfp",nt="jwp",at="jwpspotx",st="jwpdfp",ot=nt,dt="APS",lt="FAN",ut="Index",ct="OpenRTB",pt="SpotX",ht=((Ue={})[[rt]]=[dt,lt,ut,ct,pt],Ue[[nt]]=[lt,ct,pt],Ue[[st]]=[lt,ct,pt],Ue[[at]]=[pt],Ue),mt="Error loading script",ft=((Xe={})[["EMX"]]={endpoint:"https://hbint.emxdgt.com"},Xe[["PubMatic"]]={endpoint:"https://openbid.pubmatic.com/translator"},Xe[["Telaria"]]={endpoint:"https://jwplayer.eb.tremorhub.com/ad/rtb/jwp",preflight:!0},Xe),vt=1,gt=2,yt=1,At=2,wt=3,kt=4,Pt=5,_t=6,bt=7,Tt=8,It=1,Et=2,Ct=3,Rt=4,St=5,xt=6,Mt={BID_WON:0,BID_BELOW_AUCTION_FLOOR:100,LOST_TO_HIGHER_BID:102},jt="abort",Lt="bid",Ot="error",Vt="invalid",Bt="noBid",Ht="timeout",qt=((Qe={})[[Bt]]=0,Qe[[Lt]]=1,Qe[[Ht]]=2,Qe[[Vt]]=3,Qe[[jt]]=4,Qe[[Ot]]=5,Qe),Dt=550,Ft=599,Nt={0:500,400:501,500:503,597:502},Ut=[{message:"SpotX :: Unable to find ad",result:Bt,code:qt[Bt]},{message:mt,result:Ot,code:6},{message:"Invalid options: 'slot' is required",code:300},{message:"Invalid options: 'slot' must be part of DOM",code:301},{message:"Invalid options: 'channel_id' is required.",code:302},{message:"Invalid options: 'content_width' and 'content_height' are required when no 'video_slot' is provided.",code:303},{message:"Invalid options: 'content_width' provided but 'content_height' is not.",code:304},{message:"Invalid options: 'content_height' provided but 'content_width' is not.",code:305},{message:"Invalid options: 'custom' must be an object.",code:306},{message:"Invalid options: 'token' must be an object.",code:307},{message:"Invalid options: 'ados' must be an object.",code:308},{message:"Invalid options: 'contentPageUrl' must be a string.",code:309},{message:"Invalid options: 'demand_source_timeout' must be a number.",code:310},{message:"Invalid options: 'total_bid_timeout' must be a number.",code:311}],Xt=320,Qt=[{message:"Incorrect domain",code:321},{message:"unsupported_platform",code:322},{message:"Request_URL_noncompliant",code:323},{message:"Application not authorised for header bidding",code:324},{message:"pageurl is required",code:325},{message:"adformats",code:326}],Wt=Date.now||function(){return(new Date).getTime()};function zt(e,r){var t=(e||[]).filter(function(e){var t=e.min,i=e.max;return(t||0)<=r&&r<=(i||1/0)})[0];if(t){var i=t.min?Math.floor(100*t.min):0,n=Math.floor(100*r),a=.01<=t.increment?Math.floor(100*t.increment):1;return(i+Math.floor((n-i)/a)*a)/100}return parseFloat(r)}function $t(e,t,i){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{},n=e.createElement(t);return n.appendChild(e.createCDATASection(i)),Object.keys(r).forEach(function(e){n.setAttribute(e,r[e])}),n}function Jt(e){if("start"===e||"0%"===e||!e||"pre"===e||"00:00:00"===e)return 0;if("end"===e||"100%"===e||"post"===e)return-2;if("string"==typeof e&&0<=e.indexOf("%"))return-1;var t=parseInt(e);return 0<=t?t:-1}function Kt(e,t){return new t.scriptloader(e,!1,$e).load().catch(function(){return Promise.reject({message:mt})})}function Gt(e){return e.outerHTML||(new XMLSerializer).serializeToString(e)}var Yt=function(e,t){return e.replace(/\$\{AUCTION_ID\}/g,t.id).replace(/\$\{AUCTION_BID_ID\}/g,t.bid||"").replace(/\$\{AUCTION_IMP_ID\}/g,t.imp).replace(/\$\{AUCTION_SEAT_ID\}/g,t.seat||"").replace(/\$\{AUCTION_AD_ID\}/g,t.ad||"").replace(/\$\{AUCTION_CURRENCY\}/g,t.cur)},Zt=function(e,t,i){var r=i?i.priceInCents:"",n=t.priceInCents?r/t.priceInCents:"",a=Mt[i?"LOST_TO_HIGHER_BID":"BID_BELOW_AUCTION_FLOOR"];return e.replace(/\$\{AUCTION_PRICE\}/g,r/100).replace(/\$\{AUCTION_MBR\}/g,n).replace(/\$\{AUCTION_LOSS\}/g,t.winner?Mt.BID_WON:a)},ei={postAuctionHandler:function(e,t){if((!t||t.winner)&&e.result===Lt){e.adm&&(e.adm=Zt(e.adm,e,t));var i=e.winner?e.custom.nurl:e.custom.lurl;if(i)if(e.winner&&!e.adm)e.tag=Zt(i,e,t);else{var r=new XMLHttpRequest;r.open("POST",Zt(i,e,t));var n=ft[e.name];n&&n.preflight&&r.setRequestHeader("x-openrtb-version","2.5"),r.withCredentials=!0,r.send(null)}}return delete e.custom,e},requestBids:function(h,m,i,f){var r=ft[h.name];if(!r||!h.id||!h.pubid)return Promise.resolve({result:Vt});var e,t,v=m.floorPriceCurrency||Je,n=void 0!==m.skipoffset,a=f.getURLParts(),g={id:m.adPlayId,imp:[{id:"1",displaymanager:"jwplayer",tagid:h.id,video:{mimes:(e=["video/mp4","video/ogg","video/webm","video/aac","application/vnd.apple.mpegurl"],t=document.createElement("video"),e.filter(function(e){return t.canPlayType(e)})).concat("application/javascript"),minduration:3,maxduration:300,protocols:[yt,At,wt,bt,kt,Pt,_t,Tt],w:m.playerWidth,h:m.playerHeight,startdelay:Jt(m.offset),placement:m.placement,linearity:1,skip:n?1:0,skipmin:n?m.skipoffset+2:void 0,skipafter:m.skipoffset,playbackmethod:[function(e){var t=e.autoplay,i=e.mute,r=e.autoplayAdsMuted;if(t){var n=i||r;return"viewable"===t?n?xt:St:n?Et:It}return i?Rt:Ct}(m)],api:[vt,gt]},bidfloor:m.floorPriceCents/100,bidfloorcur:v.toUpperCase(),secure:"https:"===window.location.protocol?1:0}],site:{domain:a.domain,page:a.url,ref:a.referrer,publisher:{id:h.pubid}},device:{ua:window.navigator.userAgent,language:m.language.substring(0,2)},at:1};return(!0===m.autoplay||"viewable"===m.autoplay&&m.viewable)&&(g.tmax=m.bidTimeout),m.jwpseg&&(g.imp[0].video.ext={jwpseg:m.jwpseg}),f.getGDPRConsentData().then(function(e){var t=e.gdprApplies,i=e.consentData;g.regs={ext:{gdpr:t?1:0}},t&&(g.user={ext:{consent:i}})}).then(function(){return new Promise(function(e){var t=new XMLHttpRequest;t.onreadystatechange=function(){4===this.readyState&&(e(this),t=null)},t.open("POST",r.endpoint),r.preflight&&(t.setRequestHeader("content-type","application/json"),t.setRequestHeader("x-openrtb-version","2.5")),t.withCredentials=!0,t.send(JSON.stringify(g)),i.then(function(){t&&(t.abort(),t=null)})})}).then(function(e){if(200===e.status){var t=JSON.parse(e.responseText),i=t.cur?t.cur:Je;if(v.toUpperCase()!==i.toUpperCase())return{result:Ot,code:551};if(t.id===g.id&&t.seatbid&&t.seatbid.length){var r=void 0,n=t.seatbid.reduce(function(e,t){if(null===e&&t&&t.bid&&t.bid.length){var i=t.bid.filter(function(e){return e.impid===g.imp[0].id});if(i.length)return r=t.seat,i[0]}return e},null);if(n){if(n.adm){var a=f.parseXML(n.adm);if(null===a)return{result:Vt,code:331};n.adm=Gt(a.documentElement)}else if(!n.nurl)return{result:Vt,code:330};var s={id:g.id,bid:t.bidid,imp:n.impid,seat:r,ad:n.adid,cur:i},o={result:Lt,priceInCents:100*n.price,priceCurrency:t.cur||v,adm:n.adm?Yt(n.adm,s):null,custom:{exp:n.exp,nurl:n.nurl?Yt(n.nurl,s):null,lurl:n.lurl?Yt(n.lurl,s):null}};if(m.mediationLayerAdServer===rt||m.mediationLayerAdServer===st){var d,l=f.genId(12),u=h.name.toLowerCase();o.adm||(o.adm=(c=l,p=o.custom.nurl,'\n<VAST version="4.0">\n    <Ad id="'+c+'">\n        <Wrapper>\n            <AdSystem version="0.2.15">JWP</AdSystem>\n            <VASTAdTagURI><![CDATA['+p+"]]></VASTAdTagURI>\n        </Wrapper>\n    </Ad>\n</VAST>\n")),o.cacheKey=l,o.custParams=((d={})[["vpb_"+u+"_key"]]=l,d[["vpb_"+u+"_bid"]]=zt(m.buckets,n.price).toFixed(2),d)}return o}}return{result:Bt,code:void 0!==t.nbr?t.nbr+400:qt[Bt]}}var c,p;return 204===e.status?{result:Bt}:400===e.status?{result:Vt}:{result:Ot}})}};var ti={requestBids:function(e,f,i,t){var r,n,a,s,o,d,v=e.id,g=t.getURLParts(),l=(r=v,n=f.playerWidth,a=f.playerHeight,["https://an.facebook.com/v2/placementbid.json?&placementids[]="+r,"&playerwidth="+n,"&playerheight="+a,"&adformats[]="+Ye,"&SDK[]="+Ze,"&pageurl="+encodeURIComponent(g.url),"$random="+Math.random()*Math.pow(10,18)].join(""));return s=f.mediationLayerAdServer,o=f.floorPriceCents,d=f.floorPriceCurrency||Je,l&&(s===rt||o&&d===Je)?new Promise(function(e){var t=new XMLHttpRequest;t.onreadystatechange=function(){4===this.readyState&&(e(this),t=null)},t.open("GET",l),t.withCredentials=!0,t.send(null),i.then(function(){t&&(t.abort(),t=null)})}).then(function(e){if(200!==e.status)return{result:Ot,message:"Invalid response (status "+e.status+")"};var t,i,r=JSON.parse(e.responseText),n=r.errors,a=r.request_id;if(n&&n.length)return{result:Vt,code:(t=n[0],i=Qt.filter(function(e){return 0<=t.indexOf(e.message)})[0],i?i.code:Xt),requestId:a};var s=r.bids;if(!s||!s[v]||!s[v][0])return{result:Bt,requestId:a};var o=s[v][0],d=o.bid_price_cents,l=o.bid_id;if(f.mediationLayerAdServer===rt||f.mediationLayerAdServer===st)return{result:Lt,tag:f.tag,custParams:{jwFANBidPrice:zt(f.buckets,d/100).toFixed(2),jwFANBidID:l},requestId:a};var u,c,p,h,m={result:Lt,priceInCents:d,priceCurrency:o.bid_price_currency,requestId:a};return d>=f.floorPriceCents&&(m.tag=(u=v,c=l,p=f.playerWidth,h=f.playerHeight,["https://an.facebook.com/v1/instream/vast.xml?placementid="+u,"&playerwidth="+p,"&playerheight="+h,"&SDK[]="+Ze,"&bidid="+c,"&pageurl="+encodeURIComponent(g.url)].join(""))),m}).catch(function(e){return{result:Ot,message:"FAN header bidding failed: "+e}}):Promise.resolve({result:Vt})}},ii=null;function ri(t){return null===ii&&(ii=Promise.resolve(window.apstag).then(function(e){return e&&e.init&&e.fetchBids?e:Kt(["file"===document.location.protocol?"https:":"",Ge].join(""),t).then(function(){return window.apstag})}).catch(function(e){throw ii=null,e})),ii}var ni=null,ai=null;function si(e,t){if(null===ai){var i=Wt(),r=ni||window.SpotX;if(r&&r.DirectAdOS)return ai=Promise.resolve({SpotX:r,loadingTime:0});var n=["file"===document.location.protocol?"https:":"",tt,e,".js"].join("");(ai="function"==typeof require?(a=n,new Promise(function(e,t){setTimeout(t,$e),require([a],e,t)}).catch(function(){return Promise.reject({message:mt})})).then(function(e){return{SpotX:ni=e,loadingTime:Wt()-i}}).catch(function(){return oi(n,i,t)}):oi(n,i,t)).catch(function(){ai=null})}var a;return ai}function oi(e,t,i){return Kt(e,i).then(function(){return{SpotX:window.SpotX,loadingTime:Wt()-t}})}var di=void 0;var li={postAuctionHandler:function(e){return e.scriptLoadingTime=di,e},requestBids:function(e,l,t,i){if(!e.id)return Promise.resolve({result:Vt,code:302});var r={placement:l.placement,hide_skin:!0,no_vpaid_ads:!1},n={channel_id:e.id,slot:l.playerContainer,content_width:l.playerWidth,content_height:l.playerHeight,player_vendor:"SpotXJW",player_vendor_id:l.playerId,ad_volume:l.adVolume,ad_mute:l.mute?1:0,autoplay:l.autoplay,blocked_autoplay_override_mode:l.autoplayAdsMuted,start_delay:Jt(l.offset)},a=ke(r,e.optionalParams,n);return e.passFloorPrice&&l.floorPriceCents&&(a.price_floor=l.floorPriceCents/100),l.jwpseg&&(a.custom=a.custom||{},a.custom.jwpseg=l.jwpseg),si(e.id,i).then(function(e){var t=e.SpotX,i=e.loadingTime;di=i;var r=new t.DirectAdOS(a),n=Wt();return r.getAdServerKVPs().then(function(e){return{response:e,bidNetworkStartTime:n}})}).then(function(e){var t=e.response,i=e.bidNetworkStartTime,r=Wt()-i,n=t.spotx_ad_key,a={spotx_bid:zt(l.buckets,t.spotx_bid).toFixed(2),spotx_ad_key:n},s=100*parseFloat(t.spotx_bid),o={result:Lt,priceInCents:s,custParams:a,scriptLoadingTime:di,bidNetworkResponseTime:r};if(l.mediationLayerAdServer===rt)return o;var d=["file:"===document.location.protocol?"https:":"",it,n].join("");return ke(o,{tag:d,tagKey:n})}).catch(function(t){var e=Ut.filter(function(e){return e.message===t.message})[0];return e?{result:e.result||Vt,code:e.code,scriptLoadingTime:di}:{result:Ot,message:"SpotX header bidding failed: "+t,scriptLoadingTime:di}})}},ui=null;function ci(t,i){return null===ui&&(ui=Promise.resolve(window.indexapi).then(function(e){return e||Kt(["file"===document.location.protocol?"https:":"",t||et].join(""),i).then(function(){return window.indexapi})}).catch(function(e){throw ui=null,e})),ui}var pi,hi={requestBids:function(e,r,t,i){if(!e.id&&!e.script)return Promise.resolve({result:Vt});var n=ke({videoCommonArgs:{protocols:[2,3,5,6],mimes:["video/mp4","video/webm","application/javascript"],apiList:[1,2]},siteID:e.id},e);return ci(e.script,i).then(function(e){return new Promise(function(i){e.deferQueue=e.deferQueue||[],e.deferQueue.push(function(){e.solicitIndexVideoAds(r.tag,function(e,t){i({updatedTag:e,indexTargeting:t})},n)})})}).then(function(e){var t=e.indexTargeting;return void 0!==t?{result:Lt,tag:r.tag,custParams:t}:{result:Bt}}).catch(function(e){return{result:Ot,message:"Index Exchange header bidding failed: "+e}})}},mi=((pi={})[[dt]]={requestBids:function(i,r,e,t){return i.id&&i.slotID?ri(t).then(function(t){return t.init({id:i.pubId,adServer:i.adServer}),new Promise(function(e){t.fetchBids({slots:[{slotID:i.slotID}],timeout:r.bidTimeout},e)})}).then(function(e){return e&&e[0]&&e[0].slotID===i.slotID?{result:Lt,tag:r.tag,custParams:{amznbid:e[0].amznbid,amzniid:e[0].amzniid}}:{result:Bt}}).catch(function(e){return{result:Ot,message:"Amazon header bidding failed: "+e}}):Promise.resolve({result:Vt})}},pi[[lt]]=ti,pi[[ut]]=hi,pi[[ct]]=ei,pi[[pt]]=li,pi),fi=function(t,n,a){var s=t.filter(function(e){return e.result===Lt&&e.adm&&e.cacheKey});return 0===s.length?Promise.resolve(t):new Promise(function(t){var e=s.map(function(e){return{type:"xml",ttlseconds:(e.custom||{}).exp||86400,value:a.getTrackingPixelURLs?function(e,t){var i=t.parseXML(e.adm);if(null===i)return e.adm;for(var r=t.getTrackingPixelURLs(e.name,e.cacheKey),n=r.impression,a=r.error,s=i.querySelectorAll("InLine,Wrapper"),o=0;o<s.length;o+=1)s[o].appendChild($t(i,"Impression",n,{id:e.cacheKey})),s[o].appendChild($t(i,"Error",a));return Gt(i)}(e,a):e.adm,key:e.cacheKey}}),i=function(e){return function(){t({result:e,code:this.status}),r=null}},r=new XMLHttpRequest;r.onreadystatechange=function(){4===this.readyState&&(200===this.status?t({result:Lt}):t({result:Ot,code:this.status}),r=null)},r.onabort=i(jt),r.onerror=i(Ot),r.ontimeout=i(Ht),r.open("POST","https://vpb-cache.jwplayer.com/cache"),r.send(JSON.stringify({puts:e})),n.then(function(e){var t=e.result;r&&(r.onabort=i(t),r.abort(),r=null)})}).then(function(e){var r=e.result,n=e.code;return s.forEach(function(e){var t,i;e.result=r,e.result===Ot&&(e.code=(t=n,i=100*parseInt(t/100,10),Nt[t]||Nt[i]||Ft))}),t})};var vi=function(){function m(){var e,t,i,r=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},n=r.settings,a=void 0===n?{}:n,s=r.bidders,o=void 0===s?[]:s,d=this,l=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},u=arguments[2];b(this,m),this.settings=(e=a,i=ke({bidTimeout:ze,buckets:[],offset:"",playerContainer:(t=l).container,playerHeight:t.height||0,playerWidth:t.width||0,tag:"",placement:1},t,e),ht[i.mediationLayerAdServer]||(i.mediationLayerAdServer=ot),i.mediationLayerAdServer===at&&(i.floorPriceCents=Ke),i),this.utils=u;var c=0===Jt(this.settings.offset),p=this.settings.mediationLayerAdServer===nt||this.settings.mediationLayerAdServer===st,h=ht[this.settings.mediationLayerAdServer];this.bidders=o.filter(function(e){return(!isNaN(parseFloat(d.settings.floorPriceCents))||!p)&&(-1!==h.indexOf(e.type||e.name)&&(c||e.type===ct||e.name===pt))}).map(function(e){return e.name===dt&&e.id&&e.slotID?ri(u):e.name===ut&&(e.script||e.id)?ci(e.script,u):e.name===pt&&e.id&&si(e.id,u),ke(e,e.custom_params)}),this._bidRequest=null,this._currentTimeout=null,this._onCancelTrigger=null,this.onCancel=new Promise(function(e){d._onCancelTrigger=e})}return m.prototype.start=function(){var e,t,r,n,a,i,s,o;return this._bidRequest||(this._bidRequest=(e={bidders:this.bidders,settings:this.settings,onCancel:this.onCancel,utils:this.utils},t=e.bidders,r=e.settings,n=e.onCancel,a=e.utils,i=r.mediationLayerAdServer===rt||r.mediationLayerAdServer===st,s=r.mediationLayerAdServer===nt||r.mediationLayerAdServer===st||r.mediationLayerAdServer===at,o=t.map(function(t){var i=Wt();return Promise.race([mi[t.type||t.name].requestBids(t,r,n,a),n]).then(function(e){return ke({},t,e,{timeForBidResponse:Wt()-i|0},s&&{winner:!1})}).catch(function(e){return ke({},t,{result:Ot,code:Dt,message:e,timeForBidResponse:Wt()-i|0})})}),Promise.all(o).then(function(e){if(s){var t=e.reduce(function(e,t){return t.result===Lt&&(t.priceInCents>e.priceInCents||t.priceInCents===e.priceInCents&&t.timeForBidResponse<e.timeForBidResponse)?(e.winner=!1,t.winner=!0,t):e},{priceInCents:r.floorPriceCents,timeForBidResponse:1/0});if(t.winner)return{bidders:e,result:t}}return i?fi(e,n,a).then(function(e){var t=e.reduce(function(e,t){return t.result===Lt?ke(e||{},t.custParams):e},null),i={bidders:e};return null!==t&&(i.result={tag:r.tag,custParams:t}),i}):{bidders:e}}).then(function(i){return i.bidders=i.bidders.map(function(e){e.code=e.code||qt[e.result];var t=mi[e.type||e.name];return"function"==typeof t.postAuctionHandler?t.postAuctionHandler(e,i.result):e}),ke(t,i.bidders),i}))),this._bidRequest},m.prototype.stop=function(){var t=this;clearTimeout(this._currentTimeout),this._onCancelTrigger({result:jt}),this._bidRequest=null,this._currentTimeout=null,this._onCancelTrigger=null,this.onCancel=new Promise(function(e){t._onCancelTrigger=e})},m.prototype.getEventObject=function(){var e=this.settings.mediationLayerAdServer,t={bidsVersion:"0.2.15",mediationLayerAdServer:e,bidders:[].concat(this.bidders),bidTimeout:this.settings.bidTimeout};e!==nt&&e!==st||(t.floorPriceCents=+this.settings.floorPriceCents||0);var i=this.settings.floorPriceCurrency;return i&&(t.floorPriceCurrency=i),t},m.prototype.then=function(e){return this._bidRequest?this._bidRequest.then(e,e):null},m.prototype.timeout=function(){clearTimeout(this._currentTimeout),this._currentTimeout=setTimeout(this._onCancelTrigger,this.settings.bidTimeout,{result:Ht})},m}(),gi=function(){},yi=function(){function a(e,t,i,r,n){b(this,a),this.config=r,this.item=i,this.params=n,this.player=e,this.schedule=t,this.vmapPromise=null,this._preRollPromise=null,this._midRollPromise={},this._postRollPromise=null,this.vmapTracker=null,this._events=[],this._vloaderQueue=[],this._staticAdsOffset=[],this.bids=[],this.bidsPromise=null,this.bidsResult={},this._debugTrackFn=r.debug&&r.trackFn?r.trackFn:null,ke(this,e.Events)}return a.prototype.init=function(e,t){var i=this,r=this.schedule;return r.isVMAP()&&(this.vmapPromise=r._vmapPromise.catch(gi)),this.bidsPromise=this.vmapPromise||Promise.resolve(),null!==e&&(this.bidsPromise=this.bidsPromise.then(function(){return i.isDestroyed()?null:i._createBidsPromise(e,t)})),this.bidsPromise},a.prototype._createBidsPromise=function(s,o){var d=this,l=this.player,e=parseInt(s.bidOnBreaks,10);return e=0<e?e:1/0,this.bids=this.schedule.getAllAds().slice(0,e).map(function(i){var e=d.getAdIds(i),t=e.adBreakId,r=e.adPlayId,n=l.getConfig(),a=d.bidsResult[t]=new vi(s,{adPlayId:r,offset:i._offSet,width:l.getWidth(),height:l.getHeight(),container:l.getContainer(),playerId:l.id,autoplay:n.autostart,autoplayAdsMuted:d.config.autoplayadsmuted,adVolume:l.getVolume(),mute:l.getMute(),placement:L(n),skipoffset:d.config.skipoffset,language:d.config.locale||l.getConfig().language,viewable:1===l.getViewable(),jwpseg:d.item.jwpseg},{genId:l.utils.genId,getGDPRConsentData:M,getURLParts:j,parseXML:l.utils.parseXML,scriptloader:l.utils.scriptloader});return a.start(),d.trigger(de,be(d,i,o)),a.then(function(e){var t=e.result;d.isDestroyed()||(t&&!t.error&&(t.adm?(i._adXML=t.adm,i._adQueue&&i._adQueue.length&&i._adQueue.unshift(t.adm)):t.tag&&(i._adQueue=i._adQueue||[],i._adQueue.unshift(t.tag))),d.trigger(le,be(d,i,o)))}),a}),Promise.all(this.bids)},a.prototype.getAdIds=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},i=t.tagIndex,r=t.podIndex,n=e.adRequestIds&&void 0!==i?e.adRequestIds[i]:null;if(!n){var a="p"+(r||e._adPodIndex||0)+"w"+(e._waterfallIndex||0);n="p0w0"===a?e.adBreakId:e.adPlayIds[a]=e.adPlayIds[a]||this.player.utils.genId(12)}return{adBreakId:e.adBreakId,adPlayId:n}},a.prototype.loadPreRoll=function(){var t=this,i=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return null===this._preRollPromise&&(this._preRollPromise=this.bidsPromise.then(function(){if(!t.isDestroyed()){var e=t.schedule.getPreRoll(i.startTime);return e?(e._position="pre",t.loadAd(e,i)):void 0}})),this._preRollPromise},a.prototype.loadMidRollAtIndex=function(t,i){var r=this;return this._midRollPromise[t]||(this._midRollPromise[t]=this.bidsPromise.then(function(){if(!r.isDestroyed()){var e=r.schedule.getMidRollAtIndex(t);return e?(e._position="mid",r.loadAd(e,i)):void 0}})),this._midRollPromise[t]},a.prototype.loadPostRoll=function(){var t=this,i=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return null===this._postRollPromise&&(this._postRollPromise=this.bidsPromise.then(function(){if(!t.isDestroyed()){var e=t.schedule.getPostRoll(i.startTime);return e?(e._position="post",t.loadAd(e,i)):void 0}})),this._postRollPromise},a.prototype.loadAd=function(e){var t=this,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},r=this.player.utils;if(e._id=e._id||r.genId(12),this.config.preloadAds&&(e._preload=i.preload||!1),e._vmapTracker=this.getVMAPTracker(e),e._adQueue||e._adXML||e._pod){if(i.adBlock)throw _e(this,{message:"Ad playback blocked by an ad blocker",adErrorCode:600003},e,i);var n=void 0;if(e._pod)return this._loadPods(e,i);var a=function(){return t.isDestroyed()?null:t._dispatchAdLoaded(e,i)};return(n=e._adXML?this._loadXML(e,i):this._loadTag(e,i)).then(a).catch(gi),n.catch(a).catch(gi),n.catch(function(e){return t.isDestroyed()?null:t._vloaderWaterfall(e,i)})}r.log("scheduled ad has no url or xml",e)},a.prototype.getVMAPTracker=function(e){if(!e._vmapTracker){var t=new B(e._trackers,this._debugTrackFn,this.player,this.config.trackingFilter);e._vmapTracker=this.vmapTracker=t}return e._vmapTracker},a.prototype._loadTagUrl=function(r,n,a){var s=this;return Q(n,this.player,this.params).then(function(e){"function"==typeof s._debugTrackFn&&s._debugTrackFn({type:"tagReplacement",data:{actualTag:e,originalTag:n}});var t=s._createVastLoader(r,a),i=t.load(e);return a.isPodItemLoader?a.tagIndex&&(t.scheduledAd().adRequestIds[a.tagIndex]=s.player.utils.genId(12)):r._currentTag=e,s._dispatchAdRequest(r,ke({tag:e},a)),i})},a.prototype._loadTag=function(e,t){var i=e._adQueue[e._waterfallIndex];return this._loadTagUrl(e,i,t)},a.prototype._loadPods=function(a,s){var o=this;a.adRequestIds=[];var e=this._createVastLoader(a,s),t=a._pod.map(function(e,t){var i=ke({tag:e,isPodItemLoader:!0,tagIndex:t},s),r=o._loadTagUrl(a,e,i).catch(function(e){return e.tagIndex=t,Promise.reject(e)}),n=function(){return o.isDestroyed()?null:o._dispatchAdLoaded(a,i)};return r.then(n).catch(gi),r.catch(n).catch(gi),r});return e.podMultipleVastLoaders(t)},a.prototype._loadXML=function(e,t){var i;e._currentTag=e._currentTag||((i=e._adXML).ownerDocument instanceof Document?i.outerHTML||(new XMLSerializer).serializeToString(i):null)||e._adXML.toString();var r=this._createVastLoader(e,t).parseXMLString(e._adXML,e._currentTag);return this._dispatchAdRequest(e,t),r},a.prototype._dispatchAdRequest=function(e,t){this.trigger(ye,be(this,e,t))},a.prototype._dispatchAdLoaded=function(e,t){this.trigger(fe,be(this,e,t))},a.prototype._handleVastLoadError=function(e,t,i){var r=e.vloader;return this.removeVastLoader(r),this._getVloaderErrorObject(e,t,i)},a.prototype._vloaderWaterfall=function(e,t){var i=this._handleVastLoadError(e,null,t),r=e.vloader;return this.adWaterfall(r,i,t)},a.prototype.adWaterfall=function(e,t,i){var r=e.scheduledAd();if(this.schedule.canWaterfall(r))return r._adXML=null,r._waterfallIndex+=1,this._enqueueAdEvent(pe,t,i),this.loadAd(r,i);throw t},a.prototype.addStaticOffset=function(e){this._staticAdsOffset.push(e)},a.prototype._createVastLoader=function(r){var n=this,a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},e=this.config,s=new We(r,this.player,ke({requestFilter:e.requestFilter,trackingFilter:e.trackingFilter},a));this._vloaderQueue.push(s);var o=0;return s.on(ge,function(e){o+=1;var t=n._getVloaderErrorObject(e,null,a);if(n._enqueueAdEvent(pe,t,a),!(s._scheduledAd._pod&&s._scheduledAd._pod.length===o)){var i=be(n,r,{podIndex:s._scheduledAd._adPodIndex,tagIndex:o},a);n._enqueueAdEvent(me,i,a)}}),s},a.prototype._getVloaderErrorObject=function(e,t,i){return e.wrapperAdSystem&&e.wrapperAdSystem.length!==e.wrappedTags.length&&(e.wrapperAdSystem.push(e.adsystem),e.adsystem=""),_e(this,e,ke({adsystem:e.adsystem,wrapper:e.wrapperAdSystem,wrappedTags:e.wrappedTags},e.vloader.scheduledAd()),ke({tag:e.tag,tagIndex:e.tagIndex||t,podIndex:e.podIndex},i))},a.prototype._enqueueAdEvent=function(e,t,i){this._events.push({type:e,event:t}),i.preload||this.dequeueAdEvents()},a.prototype.dequeueAdEvents=function(){var r=this;this._events.forEach(function(e){var t=e.type,i=e.event;return r.trigger(t,i)}),this._events.splice(0)},a.prototype.removeVastLoader=function(e){var t=this._vloaderQueue.indexOf(e);-1!==t&&(e.destroy(),this._vloaderQueue.splice(t,1))},a.prototype.isDestroyed=function(){return null===this.player},a.prototype.destroy=function(){this.bids.forEach(function(e){return e.stop()}),this._vloaderQueue.forEach(function(e){return e.destroy()}),this.player=null},a}(),Ai=document.createElement("img"),wi=document.createElement("img");Ai.src=wi.src='data:image/svg+xml;charset=UTF-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64"><circle cx="32" cy="32" r="32" fill="%23191919"/><line stroke="%23CCC" stroke-width="6" x1="32" y1="20" x2="32" y2="44"/><line stroke="%23CCC" stroke-width="6" x1="20" y1="32" x2="44" y2="32"/></svg>',Ai.className="jw-vast-nonlinear-open-button",wi.className="jw-vast-nonlinear-close-button";var ki=function(){function a(e,t,i,r,n){b(this,a),this.player=e,this.environment=e.getEnvironment(),this.div=r,this.staticURL=t,this.clickURL=i,this.loadTimer=-1,this.animationTimer=-1,this.banner=null,ke(this,e.Events),this.banner=document.createElement("img"),this.banner.className="jw-banner",this.banner.id=this.player.id+"_vast_static",this.div.appendChild(Ai),this.div.appendChild(this.banner),this.div.appendChild(wi),this.loadTimer=setTimeout(this.imageLoadError.bind(this),n),this.banner.onerror=this.imageLoadError.bind(this),this.banner.onload=this.onLoaded.bind(this),this.banner.src=this.staticURL}return a.prototype.onLoaded=function(){if(clearTimeout(this.loadTimer),0!==this.banner.naturalWidth){this.removeBannerEventListeners();var e=this.player.utils;e.addClass(this.div,"jw-vast-nonlinear-active"),e.style(wi,{bottom:this.banner.height-8,left:this.banner.width},!0),new e.UI(this.banner).on("click tap",this.sendClick.bind(this)),wi.onclick=wi.ontouchstart=this.collapse.bind(this),Ai.onclick=Ai.ontouchstart=this.expand.bind(this),this.trigger(v)}else this.imageLoadError()},a.prototype.imageLoadError=function(){clearTimeout(this.loadTimer),this.trigger(g),this.removeBanner()},a.prototype.sendClick=function(){this.trigger(o)},a.prototype.collapse=function(e){var t=this;e.preventDefault(),this.player.utils.addClass(this.div,"jw-vast-nonlinear-collapsed"),this.animationTimer=setTimeout(function(){t.remove(t.banner),t.remove(wi),t.animationTimer=-1},250)},a.prototype.expand=function(e){-1===this.animationTimer&&(e.preventDefault(),this.player.utils.removeClass(this.div,"jw-vast-nonlinear-collapsed"),this.div.appendChild(this.banner),this.div.appendChild(wi))},a.prototype.remove=function(e){this.div.contains(e)&&this.div.removeChild(e)},a.prototype.removeBannerEventListeners=function(){this.banner.onload=this.banner.onerror=null},a.prototype.removeBanner=function(){this.removeBannerEventListeners(),this.remove(this.banner)},a.prototype.removeListeners=function(){clearTimeout(this.loadTimer),clearTimeout(this.animationTimer),wi.onclick=wi.ontouchstart=Ai.onclick=Ai.ontouchstart=null,this.off(),this.removeBannerEventListeners()},a.prototype.stop=function(){this.player.utils.removeClass(this.div,"jw-vast-nonlinear-active jw-vast-nonlinear-collapsed"),this.removeBanner(),this.remove(wi),this.remove(Ai)},a}(),Pi=function(){function i(e,t){b(this,i),this.player=e,this.div=t,this.startTime=0,this.minDur=0,this.environment=e.getEnvironment(),ke(this,e.Events),this.type="static",e.on("time",this.dispatchTime,this)}return i.prototype.playAd=function(e,t,i,r,n){this.minDur=this.player.utils.seconds(i),this.adTag=r,this.static&&(this.static.removeListeners(),this.static.stop()),this.player.utils.addClass(this.div,"jw-vast-nonlinear"),this.static=new ki(this.player,e,t,this.div,n),this.static.on(v,this.startAd,this),this.static.on(o,this.clickHandler,this),this.static.on(g,this.errorHandler,this)},i.prototype.dispatchTime=function(e){this.trigger(Y,e)},i.prototype.startAd=function(){this.startTime=this.player.getPosition(),0<this.minDur&&(0===this.startTime?this.on(Y,this.startTimingAd,this):this.on(Y,this.timeAd,this)),this.sendEvent(v)},i.prototype.startTimingAd=function(e){this.startTime=e.position,this.off(Y,this.startTimingAd,this),this.on(Y,this.timeAd,this)},i.prototype.timeAd=function(e){e.position-this.startTime>this.minDur&&(this.off(Y,this.timeAd,this),this.stop())},i.prototype.clickHandler=function(){this.sendEvent(o)},i.prototype.errorHandler=function(){this.sendEvent(g)},i.prototype.sendEvent=function(e,t){(t=t||{}).tag=t.tag||this.adTag,this.trigger(e,t)},i.prototype.removeEvents=function(){this.off()},i.prototype.getState=function(){return oe},i.prototype.stop=function(){this.startTime&&this.static&&(this.startTime=0,this.minDur=0,this.off(Y,this.startTimingAd,this),this.off(Y,this.timeAd,this),this.static.removeListeners(),this.static.stop(),this.sendEvent(y))},i.prototype.pause=function(){},i}(),_i=function(){function i(e,t){b(this,i),this.player=e,this.options=t,this.ignoreStartOnSeek=!1,this.reset(),t.timeBetweenAds&&e.on({adBreakStart:this.handleAdBreakStart,adSkipped:this.handleAdSkipped,adComplete:this.handleAdComplete,adBreakEnd:this.handleAdBreakEnd,destroyPlugin:this.destroy},this)}return i.prototype.clearStartOnSeek=function(){this.ignoreStartOnSeek=!0},i.prototype.sendAdBreakIgnored=function(e,t){var i,r;e&&this.player.trigger(n,(r=t,{id:(i=e)._breakId,tag:i._adQueue&&0<i._adQueue.length?i._adQueue[0]:i._adXML,client:u,offset:i._offSet,timeSinceLastAd:r,type:n}))},i.prototype.rulesAllowAdPlayback=function(e){var t=this.options,i=0===t.frequency&&1===e,r=e>=t.startOn&&(e-t.startOn)%t.frequency==0;return i||r},i.prototype.handleAdBreakStart=function(){this.adSkipped=!1,this.adComplete=!1},i.prototype.handleAdComplete=function(){this.adComplete=!0},i.prototype.handleAdSkipped=function(){this.adSkipped=!0},i.prototype.handleAdBreakEnd=function(){!this.adSkipped&&this.adComplete&&(this.recentCompletedAdTime=Pe())},i.prototype.timeBetweenAdsAllowsAdPlayback=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:Pe();if(this.options.timeBetweenAds){var i=(t-this.recentCompletedAdTime)/1e3;if(i<this.options.timeBetweenAds)return this.sendAdBreakIgnored(e,i),!1}return!0},i.prototype.reset=function(){this.ignoreStartOnSeek=!1,this.recentCompletedAdTime=0},i.prototype.destroy=function(){this.player.off(null,null,this)},T(i,[{key:"timeBetweenAds",get:function(){return this.options.timeBetweenAds}},{key:"startOnSeek",get:function(){return this.ignoreStartOnSeek?null:this.options.startOnSeek}}]),i}(),bi={};var Ti=function(){};!function(e){if(e&&"undefined"!=typeof window){var t=document.createElement("style");t.setAttribute("media","screen"),t.innerHTML=e,document.head.appendChild(t)}}(".jwplayer.jw-flag-time-slider-above .jw-vpaid-non-linear{bottom:66px}.jwplayer.jw-breakpoint-7 .jw-vpaid-non-linear{bottom:132px}.jwplayer.jw-flag-user-inactive:not(.jw-state-paused) .jw-vpaid-non-linear{bottom:.5em}.jwplayer .jw-vpaid-non-linear{bottom:60px}.jwplayer .jw-vpaid-iframe{border:0;width:100%;height:100%;position:absolute;overflow:hidden}.jwplayer .jw-plugin-vast.jw-plugin{top:0;width:100%;pointer-events:none}.jwplayer .jw-plugin-vast.jw-plugin *{pointer-events:all}.jwplayer .jw-plugin-vast .jw-ad-icon-container{position:absolute;display:none;pointer-events:all;cursor:pointer}.jwplayer .jw-plugin-vast .jw-ad-icon-container.jw-ad-icon-active{display:block}.jwplayer .jw-plugin-vast .jw-ad-icon-container iframe{pointer-events:none;border:none;height:100%;width:100%;margin:0}.jw-plugin-vast.jw-vast-nonlinear-active .jw-banner{opacity:1}.jw-plugin-vast.jw-vast-nonlinear-active .jw-vast-nonlinear-close-button{margin:0 auto;opacity:.75}.jw-plugin-vast.jw-vast-nonlinear-active:hover .jw-vast-nonlinear-close-button{opacity:1}.jw-plugin-vast.jw-vast-nonlinear-collapsed .jw-vast-nonlinear-open-button{margin:0 auto;opacity:.5}.jw-plugin-vast.jw-vast-nonlinear-collapsed .jw-banner,.jw-plugin-vast.jw-vast-nonlinear-collapsed .jw-vast-nonlinear-close-button{opacity:0}.jw-plugin-vast.jw-vast-nonlinear-collapsed:hover .jw-vast-nonlinear-open-button{opacity:1}.jw-plugin-vast.jw-vast-nonlinear-collapsed:hover .jw-vast-nonlinear-close-button{opacity:0}.jw-plugin-vast .jw-vast-nonlinear-close-button,.jw-plugin-vast .jw-vast-nonlinear-open-button{position:absolute;right:0;bottom:0;left:0;display:block;margin:auto;width:18px;height:18px;cursor:pointer;opacity:0;transition:opacity .2s ease}.jw-plugin-vast .jw-vast-nonlinear-close-button{transform:rotate(45deg)}"),(window.jwplayerPluginJsonp||window.jwplayer().registerPlugin)(u,"8.1",function(d,l,a){var r=d.getConfig(),e=r.key,t=d.getEnvironment(),n=l.debug&&l.trackFn?l.trackFn:null,u=this,c=null,i=l.bids&&l.bids.settings?l.bids.settings.mediationLayerAdServer||ie:null;if((i===ie||i===re)&&l.bids.bidders){var s=l.bids.bidders;s.length&&(c=ke({},l.bids,{bidders:s}))}var p={},o=!1,h=void 0,m=[],f=!1,v=void 0,g=void 0,y=void 0,A=void 0,w=0,k=0,P=!1,_=null,b=!1,T=void 0,I=new De(d.utils),E=new _i(d,I.getAdRules(l)),C=new d.utils.Timer;this.version="8.6.6",this.bidsVersion="0.2.15";var R=new Be(E,d.utils),S=I.getSchedule(l,E);function x(e){j(),M(e);var t=h;Promise.resolve(e).then(function(){if(!t.isDestroyed())return t.loadAd(e,{adBlock:P})}).then(function(e){return t.isDestroyed()?null:V(e,we)}).catch(function(e){return t.isDestroyed()?null:U(e)})}function M(e,t){var i=h,r=i.getVMAPTracker(e);A.once("destroyed",function(){C.clear("adBreakStart"),r.breakEnd(),d.trigger(ue,be(i,e)),h===i&&h.schedule.resetBreakIdByOffset(t)}),C.tick("adBreakStart"),r.breakStart();var n=be(i,e);d.trigger(ce,n),d.trigger(me,n)}function j(){A||(A=d.createInstream().init()).setText(null)}function L(e,t){var i,r,n,a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},s=(r=e,n=t,E.rulesAllowAdPlayback(n)?r&&r.adschedule?I.getSchedule(r,E):S:R),o=new yi(d,s,e,l,p);return o.on(((i={})[[de]]=function(e){return d.trigger(de,e)},i[[le]]=function(e){return d.trigger(le,e)},i[[me]]=function(e){return d.trigger(me,e)},i[[ye]]=N,i[[fe]]=F,i[[pe]]=X,i),u),s.isVMAP()&&s.load(d,p).then(function(e){o.isDestroyed()||e.forEach(function(e){X(_e(o,e,null,a))})}).catch(function(e){o.isDestroyed()||U(_e(o,e,null,a))}),o.init(c,a).then(function(){o.isDestroyed()||d.trigger(Ae,be(o,null,{schedule:s}))}),o}function O(){h&&(h.schedule.reset(),h.off(null,null,u),h.destroy(),h=null),B(),D(),q(),E.reset(),d.setCues([]),k=0,o=!1}function V(e,t){if(h.dequeueAdEvents(),e)return"nonlinear"===e.scheduledAd()._type&&D(),function(r,n){var e=r.scheduledAd();0===e._waterfallIndex&&q(),h.removeVastLoader(r);var t=new Promise(function(e,t){var i=new Te(r,d,g,y,h,a,p);i.on(ve,e),i.on(pe,t),i.on(he,H),i.on(ge,X),i.init(A,n).catch(Ti),v=A,A=null,m.push(i)}),i=h;return t.then(function(){i.isDestroyed()||"nonlinear"===e._type||D()}).catch(function(e){if(!i.isDestroyed())return A=A||v,i.adWaterfall(r,e,{adBlock:P}).then(function(e){return i.isDestroyed()?null:V(e,n)})})}(e,t);D()}function B(){m.forEach(function(e){return e.destroy()}),m.splice(0)}function H(e){Q(e)&&(C.tick("adImpression"+e.id),e.timeLoading=C.between("adBreakStart","adImpression"+e.id)),d.trigger(he,e)}function q(){m.length&&m[m.length-1].clearNonlinear()}function D(){if(A||v){var e=A||v;A=null,e.destroy()}v=null}function F(e){var t=e.id;C.tick("adLoaded"+t),e.timeLoading=C.between("adLoading"+t,"adLoaded"+t),d.trigger(fe,e)}function N(e){d.trigger(ye,e),C.tick("adLoading"+e.id)}function U(e){e&&e.adErrorCode||(e=_e(h,{message:"An unexpected ad error has occurred",sourceError:e})),h.dequeueAdEvents(),X(e),B(),D()}function X(e){Q(e)&&(C.tick("adError"+e.id),e.timeLoading=C.between("adBreakStart","adError"+e.id)),h&&h.vmapTracker&&h.vmapTracker.error(e.code),50004!==e.adErrorCode&&50901!==e.adErrorCode||!d.getAdBlock()||(P=!0),d.trigger(pe,e)}function Q(e){return e.tag&&(void 0===e.podcount||1===e.sequence)}function W(e){var t=e.getMidRolls(),i=[];t.length&&t.forEach(function(e){"nonlinear"!==e._type&&i.push({begin:e._offSet,text:p.cuetext})}),d.addCues(i)}S.isVMAP()&&S.load(d,p).catch(Ti),ke(this,d.Events),d.utils.addClass(a,"jw-plugin-vast"),d.on({all:function(e,t){e===Y?function(e){if(!f&&0!==e.duration){var t=h.schedule.getNextMidrollIndex(k,e.position,e.duration);if(k=e.position,null!==t){var i=h.schedule.getMidRollAtIndex(t);"nonlinear"!==i._type&&(j(),M(i,t));var r=h;r.loadMidRollAtIndex(t,{adBlock:P}).then(function(e){return r.isDestroyed()?null:V(e)}).catch(function(e){return r.isDestroyed()?null:U(e)})}else if(l.preloadAds){var n=e.position+se,a=h.schedule.peek(e.position,n,e.duration);if(null!==a&&0<=a)h.loadMidRollAtIndex(a,{adBlock:P,preload:!0}).catch(Ti);else if(-1===a){var s=Pe()+1e3*(e.duration-e.position);h.loadPostRoll({adBlock:P,preload:!0,startTime:s}).catch(Ti)}else if(null===_&&n>e.duration){var o=d.getPlaylistItem(d.getPlaylistIndex()+1);b=!o,(o||T)&&((_=L(o||T,w+1,{preload:!0})).loadPreRoll({adBlock:P,preload:!0}).catch(Ti),T=null)}}}}(t):e===Z&&function(){if(!f){var e=h.schedule.getPostRoll();if(e){"nonlinear"!==e._type&&(j(),M(e,"post"));var t=h;t.loadPostRoll({adBlock:P}).then(function(e){return t.isDestroyed()?null:V(e)}).catch(function(e){return t.isDestroyed()?null:U(e)})}}}()},ready:function(){var i=this;g=new Pi(d,a),y=new Ie(n,t,{openLink:d.utils.openLink}),r.localization=d.getConfig().localization,(p=I.getOptParams(l,r.localization.advertising)).debugTrackFn=n,K.catch(function(e){O(),d.off(null,null,i),d.playAd=Ti;var t=_e(null,{message:"Ad Error: "+e.message,adErrorCode:60002,id:G,tag:""});X(t)})},relatedReady:function(){if(l.preloadAds){var e=d.getPlugin("related");e&&e.on("nextUp",function(e){e&&"discovery"===e.mode&&(T=e)})}},beforePlay:function(i){if(!f&&!o){o=!0,h.bids.forEach(function(e){return e.timeout()});var t=(i||{}).startTime||d.getPosition();k=t||k;var e=h.schedule.getPreRoll(t);if(e||h.vmapPromise){(null!==h.vmapPromise||e&&"nonlinear"!==e._type)&&j();var r=h;r.bidsPromise.then(function(){if(!r.isDestroyed()){var e=r.schedule.getPreRoll(t);e&&"nonlinear"!==e._type&&M(e,"pre")}}),t?"none"===E.startOnSeek&&(h._preRollPromise=null):E.clearStartOnSeek(),r.loadPreRoll({adBlock:P,startTime:t}).then(function(e){var t=i&&i.playReason?i.playReason:we;return r.isDestroyed()?null:V(e,t)}).catch(function(e){return r.isDestroyed()?null:U(e)})}}},cast:function(e){f=!!e.active},play:function(e){u.trigger(oe,e)},playlistItem:function(e){w+=1,O();var t=d.getPlaylistItem(e.index);if(_&&t!==_.item&&!1===b&&(_.off(null,null,u),_.destroy(),_=null),h=_||L(t,w),_=null,h.schedule.isVMAP()?h.vmapPromise.then(function(){h.isDestroyed()||W(h.schedule)}).catch(Ti):W(h.schedule),l.preloadAds&&1===w){var i=r.autostart;!1===i||i===ae&&0===d.getViewable()?h.loadPreRoll({adBlock:P,preload:!0}).catch(Ti):d.once(ne,function(){h.loadPreRoll({adBlock:P,preload:!0}).catch(Ti)})}},playlistComplete:O,complete:function(){q(),o=!1},destroyPlugin:O},this),d.pauseAd=function(e,t){if(e="boolean"!=typeof e||e,m.length){var i=m[m.length-1];e?i.pause(t||{}):i.play(t||{})}},d.playAd=function(e){q();var t=void 0,i=0===p.requestTimeout?1/0:p.requestTimeout,r=0===p.creativeTimeout?1/0:p.creativeTimeout;t=Array.isArray(e)?e.slice(0):[e];var n,a=d.utils.genId,s={_id:a(12),_adQueue:t,_waterfallIndex:0,_adPodIndex:0,adBreakId:a(12),_offset:0,_position:(n=d,n.isBeforePlay()||0===n.getPosition()&&"idle"===n.getState()?"pre":n.isBeforeComplete()||n.getPosition()===n.getDuration()?"post":"mid"),requestTimeout:i||ee,creativeTimeout:r||te};h?x(s):d.once("playlistItem",function(){return x(s)})},d.skipAd=function(){m.length&&m[m.length-1].skip()};var z,$,J,K=(z=d.utils,J=l,bi[$=e]||(bi[$]=new Promise(function(n,a){!function(t){var e=new z.key($);if("unlimited"===e.edition())return t();var i=["//","entitlements.jwplayer.com","/",e.token(),".json"];"file:"===window.location.protocol&&i.unshift("https:"),z.ajax(i.join(""),function(e){t(e&&e.response)},function(){t()},{timeout:1e4,responseType:"json"})}(function(e){var t=e||{},i=void 0,r=void 0;!0===J.outstream?(i=!1!==t.canPlayOutstreamAds,r="Outstream Ad Limit Reached"):(i=!1!==t.canPlayAds,r="Ad Limit Reached"),!1!==i?n({message:"Can Play Ads"}):a({message:r})})})));K.catch(Ti),this.destroy=O})}();
